# Simulating today’s hockey games
chicken
2026-01-27

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## **Intro**

Use the `chickenstats` library to scrape play-by-play data, aggregate to
the team level, then run monte carlo simulations to predict the winners
of today’s games.

Parts of this tutorial are optional and will be clearly marked as such.
For help, or any questions, please don’t hesitate to reach out to
<chicken@chickenandstats.com> or
[@chickenandstats.com](https://bsky.app/profile/chickenandstats.com) on
Blue Sky.

------------------------------------------------------------------------

![](./charts/2026-01-24_NSH.png)

------------------------------------------------------------------------

## **Housekeeping**

### Import dependencies

Import the dependencies we’ll need for the guide

``` python
import matplotlib.pyplot as plt
import seaborn as sns

import polars as pl

from pathlib import Path
import datetime as dt


from chickenstats.chicken_nhl import Scraper, Season
from chickenstats.chicken_nhl._helpers import charts_directory
from chickenstats.chicken_nhl.team import NHL_COLORS

from monte_carlo import (
    aggregate_strength_states,
    prep_nhl_stats,
    prep_team_stats,
    prep_todays_games,
    simulate_game,
    predict_game,
    predict_games,
    process_winners,
    assess_predictions,
)
```

### Polars options

Set different polars options. This cell is optional

``` python
pl.Config.set_tbl_cols(-1)
```

    polars.config.Config

### Folder structure

``` python
charts_directory()
```

### Chickenstats matplotlib style

chickenstats.utilities includes a custom style package - this activates
it. This cell is also optional

``` python
plt.style.use("chickenstats")
```

------------------------------------------------------------------------

## **Scrape data**

### Schedule

Scrape the schedule using the `Season` object

``` python
season = Season(2025, backend="polars")
```

``` python
schedule = season.schedule()
```

    Output()

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>

### Standings and team names

Scrape the standings and create team name dictionaries to use later

``` python
standings = season.standings
```

``` python
standings.head(5)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 57)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">team</th>
<th data-quarto-table-cell-role="th">team_name</th>
<th data-quarto-table-cell-role="th">conference</th>
<th data-quarto-table-cell-role="th">division</th>
<th data-quarto-table-cell-role="th">games_played</th>
<th data-quarto-table-cell-role="th">points</th>
<th data-quarto-table-cell-role="th">points_pct</th>
<th data-quarto-table-cell-role="th">wins</th>
<th data-quarto-table-cell-role="th">regulation_wins</th>
<th data-quarto-table-cell-role="th">shootout_wins</th>
<th data-quarto-table-cell-role="th">losses</th>
<th data-quarto-table-cell-role="th">ot_losses</th>
<th data-quarto-table-cell-role="th">shootout_losses</th>
<th data-quarto-table-cell-role="th">ties</th>
<th data-quarto-table-cell-role="th">win_pct</th>
<th data-quarto-table-cell-role="th">regulation_win_pct</th>
<th data-quarto-table-cell-role="th">streak_code</th>
<th data-quarto-table-cell-role="th">streak_count</th>
<th data-quarto-table-cell-role="th">goals_for</th>
<th data-quarto-table-cell-role="th">goals_against</th>
<th data-quarto-table-cell-role="th">goals_for_pct</th>
<th data-quarto-table-cell-role="th">goal_differential</th>
<th data-quarto-table-cell-role="th">goal_differential_pct</th>
<th data-quarto-table-cell-role="th">home_games_played</th>
<th data-quarto-table-cell-role="th">home_points</th>
<th data-quarto-table-cell-role="th">home_goals_for</th>
<th data-quarto-table-cell-role="th">home_goals_against</th>
<th data-quarto-table-cell-role="th">home_goal_differential</th>
<th data-quarto-table-cell-role="th">home_wins</th>
<th data-quarto-table-cell-role="th">home_losses</th>
<th data-quarto-table-cell-role="th">home_ot_losses</th>
<th data-quarto-table-cell-role="th">home_ties</th>
<th data-quarto-table-cell-role="th">home_regulation_wins</th>
<th data-quarto-table-cell-role="th">road_games_played</th>
<th data-quarto-table-cell-role="th">road_points</th>
<th data-quarto-table-cell-role="th">road_goals_for</th>
<th data-quarto-table-cell-role="th">road_goals_against</th>
<th data-quarto-table-cell-role="th">road_goal_differential</th>
<th data-quarto-table-cell-role="th">road_wins</th>
<th data-quarto-table-cell-role="th">road_losses</th>
<th data-quarto-table-cell-role="th">road_ot_losses</th>
<th data-quarto-table-cell-role="th">road_ties</th>
<th data-quarto-table-cell-role="th">road_regulation_wins</th>
<th data-quarto-table-cell-role="th">l10_points</th>
<th data-quarto-table-cell-role="th">l10_goals_for</th>
<th data-quarto-table-cell-role="th">l10_goals_against</th>
<th data-quarto-table-cell-role="th">l10_goal_differential</th>
<th data-quarto-table-cell-role="th">l10_wins</th>
<th data-quarto-table-cell-role="th">l10_losses</th>
<th data-quarto-table-cell-role="th">l10_ot_losses</th>
<th data-quarto-table-cell-role="th">l10_ties</th>
<th data-quarto-table-cell-role="th">l10_regulation_wins</th>
<th data-quarto-table-cell-role="th">team_logo</th>
<th data-quarto-table-cell-role="th">wildcard_sequence</th>
<th data-quarto-table-cell-role="th">waivers_sequence</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>i64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr>
<td>20252026</td>
<td>"2026-02-05"</td>
<td>"COL"</td>
<td>"Colorado Avalanche"</td>
<td>"Western"</td>
<td>"Central"</td>
<td>55</td>
<td>83</td>
<td>0.754545</td>
<td>37</td>
<td>34</td>
<td>1</td>
<td>9</td>
<td>9</td>
<td>null</td>
<td>0</td>
<td>0.672727</td>
<td>0.618182</td>
<td>"W"</td>
<td>1</td>
<td>212</td>
<td>138</td>
<td>3.854545</td>
<td>74</td>
<td>1.345455</td>
<td>28</td>
<td>46</td>
<td>117</td>
<td>66</td>
<td>51</td>
<td>21</td>
<td>3</td>
<td>4</td>
<td>0</td>
<td>21</td>
<td>27</td>
<td>37</td>
<td>95</td>
<td>72</td>
<td>23</td>
<td>16</td>
<td>6</td>
<td>5</td>
<td>0</td>
<td>13</td>
<td>9</td>
<td>30</td>
<td>35</td>
<td>-5</td>
<td>4</td>
<td>5</td>
<td>1</td>
<td>0</td>
<td>4</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>0</td>
<td>32</td>
</tr>
<tr>
<td>20252026</td>
<td>"2026-02-05"</td>
<td>"CAR"</td>
<td>"Carolina Hurricanes"</td>
<td>"Eastern"</td>
<td>"Metropolitan"</td>
<td>57</td>
<td>78</td>
<td>0.684211</td>
<td>36</td>
<td>26</td>
<td>4</td>
<td>15</td>
<td>6</td>
<td>null</td>
<td>0</td>
<td>0.631579</td>
<td>0.45614</td>
<td>"W"</td>
<td>3</td>
<td>197</td>
<td>163</td>
<td>3.45614</td>
<td>34</td>
<td>0.596491</td>
<td>31</td>
<td>44</td>
<td>118</td>
<td>94</td>
<td>24</td>
<td>21</td>
<td>8</td>
<td>2</td>
<td>0</td>
<td>15</td>
<td>26</td>
<td>34</td>
<td>79</td>
<td>69</td>
<td>10</td>
<td>15</td>
<td>7</td>
<td>4</td>
<td>0</td>
<td>11</td>
<td>18</td>
<td>39</td>
<td>21</td>
<td>18</td>
<td>8</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>7</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>0</td>
<td>30</td>
</tr>
<tr>
<td>20252026</td>
<td>"2026-02-05"</td>
<td>"MIN"</td>
<td>"Minnesota Wild"</td>
<td>"Western"</td>
<td>"Central"</td>
<td>58</td>
<td>78</td>
<td>0.672414</td>
<td>34</td>
<td>21</td>
<td>4</td>
<td>14</td>
<td>10</td>
<td>null</td>
<td>0</td>
<td>0.586207</td>
<td>0.362069</td>
<td>"W"</td>
<td>5</td>
<td>196</td>
<td>169</td>
<td>3.37931</td>
<td>27</td>
<td>0.465517</td>
<td>30</td>
<td>41</td>
<td>97</td>
<td>91</td>
<td>6</td>
<td>17</td>
<td>6</td>
<td>7</td>
<td>0</td>
<td>9</td>
<td>28</td>
<td>37</td>
<td>99</td>
<td>78</td>
<td>21</td>
<td>17</td>
<td>8</td>
<td>3</td>
<td>0</td>
<td>12</td>
<td>17</td>
<td>46</td>
<td>33</td>
<td>13</td>
<td>8</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>0</td>
<td>28</td>
</tr>
<tr>
<td>20252026</td>
<td>"2026-02-05"</td>
<td>"DAL"</td>
<td>"Dallas Stars"</td>
<td>"Western"</td>
<td>"Central"</td>
<td>57</td>
<td>77</td>
<td>0.675439</td>
<td>34</td>
<td>28</td>
<td>4</td>
<td>14</td>
<td>9</td>
<td>null</td>
<td>0</td>
<td>0.596491</td>
<td>0.491228</td>
<td>"W"</td>
<td>6</td>
<td>193</td>
<td>160</td>
<td>3.385965</td>
<td>33</td>
<td>0.578947</td>
<td>26</td>
<td>35</td>
<td>85</td>
<td>72</td>
<td>13</td>
<td>16</td>
<td>7</td>
<td>3</td>
<td>0</td>
<td>13</td>
<td>31</td>
<td>42</td>
<td>108</td>
<td>88</td>
<td>20</td>
<td>18</td>
<td>7</td>
<td>6</td>
<td>0</td>
<td>15</td>
<td>14</td>
<td>32</td>
<td>27</td>
<td>5</td>
<td>7</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>0</td>
<td>29</td>
</tr>
<tr>
<td>20252026</td>
<td>"2026-02-05"</td>
<td>"TBL"</td>
<td>"Tampa Bay Lightning"</td>
<td>"Eastern"</td>
<td>"Atlantic"</td>
<td>54</td>
<td>76</td>
<td>0.703704</td>
<td>36</td>
<td>27</td>
<td>4</td>
<td>14</td>
<td>4</td>
<td>null</td>
<td>0</td>
<td>0.666667</td>
<td>0.5</td>
<td>"W"</td>
<td>4</td>
<td>193</td>
<td>139</td>
<td>3.574074</td>
<td>54</td>
<td>1.0</td>
<td>26</td>
<td>34</td>
<td>85</td>
<td>70</td>
<td>15</td>
<td>17</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>11</td>
<td>28</td>
<td>42</td>
<td>108</td>
<td>69</td>
<td>39</td>
<td>19</td>
<td>5</td>
<td>4</td>
<td>0</td>
<td>16</td>
<td>17</td>
<td>35</td>
<td>24</td>
<td>11</td>
<td>8</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>4</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>0</td>
<td>31</td>
</tr>
</tbody>
</table>

</div>

``` python
team_names = standings.sort(by="team_name")["team_name"].str.to_uppercase().to_list()
team_codes = standings.sort(by="team_name")["team"].str.to_uppercase().to_list()
team_names_dict = dict(zip(team_codes, team_names, strict=False))

home_teams = dict(zip(schedule["game_id"].to_list(), schedule["home_team"].to_list(), strict=False))
```

### Game IDs

Create a list of game IDs to scrape

``` python
conds = pl.col("game_state") == "OFF"

game_ids = schedule.filter(conds)["game_id"].unique().to_list()
```

### Latest date

Important! If you don’t set this, it will just pull from the last
completed game

``` python
conds = pl.col("game_state") == "OFF"

dt_format = "%Y-%m-%d"
latest_date_dt = schedule.filter(conds)["game_date"].str.to_datetime(format=dt_format).max()  # In YYYY-MM-DD format
latest_date = latest_date_dt.strftime(dt_format)

latest_date = "2026-01-24"
latest_date_dt = dt.date(year=int(latest_date[:4]), month=int(latest_date[5:7]), day=int(latest_date[8:10]))
```

### Checking to see if you’ve already scraped the data

Check to see if you’ve already scraped, so you’re only getting the
game_ids that you need

``` python
data_directory = Path.cwd() / "data"
stats_file = data_directory / "team_stats.csv"

if not data_directory.exists():
    data_directory.mkdir()

if stats_file.exists():
    team_stats = pl.read_csv(source=stats_file, infer_schema_length=2000)

    saved_game_ids = team_stats["game_id"].to_list()
    game_ids = [x for x in game_ids if x not in saved_game_ids]
```

``` python
if game_ids:
    scraper = Scraper(game_ids, backend="polars")

    pbp = scraper.play_by_play
    scraped_team_stats = scraper.team_stats
```

    Output()

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>

    Output()

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>

### Combine scraped and saved data

Combine the scraped data and the saved data, then save the new file, but
only if there are game_ids

``` python
if game_ids:
    team_stats = pl.concat(
        [team_stats.with_columns(pl.col("bsf_adj_percent").cast(pl.Float64)), scraped_team_stats], strict=False
    )  # Quick, don't ask
    team_stats.write_csv(stats_file)
```

``` python
team_stats.head(5)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 141)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">session</th>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">game_date</th>
<th data-quarto-table-cell-role="th">team</th>
<th data-quarto-table-cell-role="th">opp_team</th>
<th data-quarto-table-cell-role="th">strength_state</th>
<th data-quarto-table-cell-role="th">toi</th>
<th data-quarto-table-cell-role="th">gf</th>
<th data-quarto-table-cell-role="th">ga</th>
<th data-quarto-table-cell-role="th">gf_adj</th>
<th data-quarto-table-cell-role="th">ga_adj</th>
<th data-quarto-table-cell-role="th">hdgf</th>
<th data-quarto-table-cell-role="th">hdga</th>
<th data-quarto-table-cell-role="th">xgf</th>
<th data-quarto-table-cell-role="th">xga</th>
<th data-quarto-table-cell-role="th">xgf_adj</th>
<th data-quarto-table-cell-role="th">xga_adj</th>
<th data-quarto-table-cell-role="th">sf</th>
<th data-quarto-table-cell-role="th">sa</th>
<th data-quarto-table-cell-role="th">sf_adj</th>
<th data-quarto-table-cell-role="th">sa_adj</th>
<th data-quarto-table-cell-role="th">hdsf</th>
<th data-quarto-table-cell-role="th">hdsa</th>
<th data-quarto-table-cell-role="th">ff</th>
<th data-quarto-table-cell-role="th">fa</th>
<th data-quarto-table-cell-role="th">ff_adj</th>
<th data-quarto-table-cell-role="th">fa_adj</th>
<th data-quarto-table-cell-role="th">hdff</th>
<th data-quarto-table-cell-role="th">hdfa</th>
<th data-quarto-table-cell-role="th">cf</th>
<th data-quarto-table-cell-role="th">ca</th>
<th data-quarto-table-cell-role="th">cf_adj</th>
<th data-quarto-table-cell-role="th">ca_adj</th>
<th data-quarto-table-cell-role="th">bsf</th>
<th data-quarto-table-cell-role="th">bsa</th>
<th data-quarto-table-cell-role="th">bsf_adj</th>
<th data-quarto-table-cell-role="th">bsa_adj</th>
<th data-quarto-table-cell-role="th">msf</th>
<th data-quarto-table-cell-role="th">msa</th>
<th data-quarto-table-cell-role="th">msf_adj</th>
<th data-quarto-table-cell-role="th">msa_adj</th>
<th data-quarto-table-cell-role="th">hdmsf</th>
<th data-quarto-table-cell-role="th">hdmsa</th>
<th data-quarto-table-cell-role="th">teammate_block</th>
<th data-quarto-table-cell-role="th">hf</th>
<th data-quarto-table-cell-role="th">ht</th>
<th data-quarto-table-cell-role="th">give</th>
<th data-quarto-table-cell-role="th">take</th>
<th data-quarto-table-cell-role="th">ozf</th>
<th data-quarto-table-cell-role="th">nzf</th>
<th data-quarto-table-cell-role="th">dzf</th>
<th data-quarto-table-cell-role="th">fow</th>
<th data-quarto-table-cell-role="th">fol</th>
<th data-quarto-table-cell-role="th">ozfw</th>
<th data-quarto-table-cell-role="th">ozfl</th>
<th data-quarto-table-cell-role="th">nzfw</th>
<th data-quarto-table-cell-role="th">nzfl</th>
<th data-quarto-table-cell-role="th">dzfw</th>
<th data-quarto-table-cell-role="th">dzfl</th>
<th data-quarto-table-cell-role="th">pent0</th>
<th data-quarto-table-cell-role="th">pent2</th>
<th data-quarto-table-cell-role="th">pent4</th>
<th data-quarto-table-cell-role="th">pent5</th>
<th data-quarto-table-cell-role="th">pent10</th>
<th data-quarto-table-cell-role="th">pend0</th>
<th data-quarto-table-cell-role="th">pend2</th>
<th data-quarto-table-cell-role="th">pend4</th>
<th data-quarto-table-cell-role="th">pend5</th>
<th data-quarto-table-cell-role="th">pend10</th>
<th data-quarto-table-cell-role="th">gf_p60</th>
<th data-quarto-table-cell-role="th">ga_p60</th>
<th data-quarto-table-cell-role="th">gf_adj_p60</th>
<th data-quarto-table-cell-role="th">ga_adj_p60</th>
<th data-quarto-table-cell-role="th">hdgf_p60</th>
<th data-quarto-table-cell-role="th">hdga_p60</th>
<th data-quarto-table-cell-role="th">xgf_p60</th>
<th data-quarto-table-cell-role="th">xga_p60</th>
<th data-quarto-table-cell-role="th">xgf_adj_p60</th>
<th data-quarto-table-cell-role="th">xga_adj_p60</th>
<th data-quarto-table-cell-role="th">sf_p60</th>
<th data-quarto-table-cell-role="th">sa_p60</th>
<th data-quarto-table-cell-role="th">sf_adj_p60</th>
<th data-quarto-table-cell-role="th">sa_adj_p60</th>
<th data-quarto-table-cell-role="th">hdsf_p60</th>
<th data-quarto-table-cell-role="th">hdsa_p60</th>
<th data-quarto-table-cell-role="th">ff_p60</th>
<th data-quarto-table-cell-role="th">fa_p60</th>
<th data-quarto-table-cell-role="th">ff_adj_p60</th>
<th data-quarto-table-cell-role="th">fa_adj_p60</th>
<th data-quarto-table-cell-role="th">hdff_p60</th>
<th data-quarto-table-cell-role="th">hdfa_p60</th>
<th data-quarto-table-cell-role="th">cf_p60</th>
<th data-quarto-table-cell-role="th">ca_p60</th>
<th data-quarto-table-cell-role="th">cf_adj_p60</th>
<th data-quarto-table-cell-role="th">ca_adj_p60</th>
<th data-quarto-table-cell-role="th">bsf_p60</th>
<th data-quarto-table-cell-role="th">bsa_p60</th>
<th data-quarto-table-cell-role="th">bsf_adj_p60</th>
<th data-quarto-table-cell-role="th">bsa_adj_p60</th>
<th data-quarto-table-cell-role="th">msf_p60</th>
<th data-quarto-table-cell-role="th">msa_p60</th>
<th data-quarto-table-cell-role="th">msf_adj_p60</th>
<th data-quarto-table-cell-role="th">msa_adj_p60</th>
<th data-quarto-table-cell-role="th">hdmsf_p60</th>
<th data-quarto-table-cell-role="th">hdmsa_p60</th>
<th data-quarto-table-cell-role="th">teammate_block_p60</th>
<th data-quarto-table-cell-role="th">hf_p60</th>
<th data-quarto-table-cell-role="th">ht_p60</th>
<th data-quarto-table-cell-role="th">give_p60</th>
<th data-quarto-table-cell-role="th">take_p60</th>
<th data-quarto-table-cell-role="th">pent0_p60</th>
<th data-quarto-table-cell-role="th">pent2_p60</th>
<th data-quarto-table-cell-role="th">pent4_p60</th>
<th data-quarto-table-cell-role="th">pent5_p60</th>
<th data-quarto-table-cell-role="th">pent10_p60</th>
<th data-quarto-table-cell-role="th">pend0_p60</th>
<th data-quarto-table-cell-role="th">pend2_p60</th>
<th data-quarto-table-cell-role="th">pend4_p60</th>
<th data-quarto-table-cell-role="th">pend5_p60</th>
<th data-quarto-table-cell-role="th">pend10_p60</th>
<th data-quarto-table-cell-role="th">gf_percent</th>
<th data-quarto-table-cell-role="th">gf_adj_percent</th>
<th data-quarto-table-cell-role="th">hdgf_percent</th>
<th data-quarto-table-cell-role="th">xgf_percent</th>
<th data-quarto-table-cell-role="th">xgf_adj_percent</th>
<th data-quarto-table-cell-role="th">sf_percent</th>
<th data-quarto-table-cell-role="th">sf_adj_percent</th>
<th data-quarto-table-cell-role="th">hdsf_percent</th>
<th data-quarto-table-cell-role="th">ff_percent</th>
<th data-quarto-table-cell-role="th">ff_adj_percent</th>
<th data-quarto-table-cell-role="th">hdff_percent</th>
<th data-quarto-table-cell-role="th">cf_percent</th>
<th data-quarto-table-cell-role="th">cf_adj_percent</th>
<th data-quarto-table-cell-role="th">bsf_percent</th>
<th data-quarto-table-cell-role="th">bsf_adj_percent</th>
<th data-quarto-table-cell-role="th">msf_percent</th>
<th data-quarto-table-cell-role="th">msf_adj_percent</th>
<th data-quarto-table-cell-role="th">hdmsf_percent</th>
<th data-quarto-table-cell-role="th">hf_percent</th>
<th data-quarto-table-cell-role="th">take_percent</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>2025020813</td>
<td>"2026-01-24"</td>
<td>"CAR"</td>
<td>"OTT"</td>
<td>"5v4"</td>
<td>5.5</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.266756</td>
<td>0.175814</td>
<td>0.311799</td>
<td>0.153621</td>
<td>1</td>
<td>1</td>
<td>1.200956</td>
<td>1.200956</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>1.205802</td>
<td>2.411605</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>1.205802</td>
<td>2.411605</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>0.854207</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>0</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.910065</td>
<td>1.917967</td>
<td>3.40144</td>
<td>1.67587</td>
<td>10.909091</td>
<td>10.909091</td>
<td>13.101342</td>
<td>13.101342</td>
<td>10.909091</td>
<td>0.0</td>
<td>10.909091</td>
<td>21.818182</td>
<td>13.154208</td>
<td>26.308416</td>
<td>10.909091</td>
<td>0.0</td>
<td>10.909091</td>
<td>21.818182</td>
<td>13.154208</td>
<td>26.308416</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>10.909091</td>
<td>0.0</td>
<td>9.31862</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>10.909091</td>
<td>0.0</td>
<td>10.909091</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>10.909091</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.602743</td>
<td>0.66993</td>
<td>0.5</td>
<td>0.5</td>
<td>1.0</td>
<td>0.333333</td>
<td>0.333333</td>
<td>1.0</td>
<td>0.333333</td>
<td>0.333333</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>2025020103</td>
<td>"2025-10-21"</td>
<td>"FLA"</td>
<td>"BOS"</td>
<td>"4v5"</td>
<td>9.3</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>0.868644</td>
<td>0</td>
<td>1</td>
<td>0.337972</td>
<td>0.40907</td>
<td>0.388038</td>
<td>0.357434</td>
<td>2</td>
<td>3</td>
<td>1.78708</td>
<td>2.569967</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>6</td>
<td>2.6342</td>
<td>5.125241</td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>9</td>
<td>2.6342</td>
<td>5.125241</td>
<td>0</td>
<td>3</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>3</td>
<td>1.205802</td>
<td>2.56262</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>3</td>
<td>3</td>
<td>6</td>
<td>0</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>6.451613</td>
<td>0.0</td>
<td>5.604155</td>
<td>0.0</td>
<td>6.451613</td>
<td>2.180462</td>
<td>2.639159</td>
<td>2.503471</td>
<td>2.306027</td>
<td>12.903226</td>
<td>19.354839</td>
<td>11.529549</td>
<td>16.580431</td>
<td>0.0</td>
<td>6.451613</td>
<td>19.354839</td>
<td>38.709677</td>
<td>16.994839</td>
<td>33.066069</td>
<td>0.0</td>
<td>12.903226</td>
<td>19.354839</td>
<td>58.064516</td>
<td>16.994839</td>
<td>33.066069</td>
<td>0.0</td>
<td>19.354839</td>
<td>0.0</td>
<td>0.0</td>
<td>6.451613</td>
<td>19.354839</td>
<td>7.77937</td>
<td>16.533035</td>
<td>0.0</td>
<td>6.451613</td>
<td>0.0</td>
<td>19.354839</td>
<td>6.451613</td>
<td>6.451613</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.452414</td>
<td>0.520526</td>
<td>0.4</td>
<td>0.410159</td>
<td>0.0</td>
<td>0.333333</td>
<td>0.339483</td>
<td>0.0</td>
<td>0.25</td>
<td>0.339483</td>
<td>0.0</td>
<td>NaN</td>
<td>0.25</td>
<td>0.319975</td>
<td>0.0</td>
<td>0.75</td>
<td>0.0</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>2025020849</td>
<td>"2026-01-29"</td>
<td>"NYR"</td>
<td>"NYI"</td>
<td>"5v4"</td>
<td>5.366667</td>
<td>1</td>
<td>0</td>
<td>0.868644</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.217852</td>
<td>0.0</td>
<td>0.190353</td>
<td>0.0</td>
<td>2</td>
<td>0</td>
<td>1.713311</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>1.708414</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>1.708414</td>
<td>0.0</td>
<td>2</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>11.180124</td>
<td>0.0</td>
<td>9.711549</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.435613</td>
<td>0.0</td>
<td>2.128175</td>
<td>0.0</td>
<td>22.360248</td>
<td>0.0</td>
<td>19.155032</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>22.360248</td>
<td>0.0</td>
<td>19.100276</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>44.720497</td>
<td>0.0</td>
<td>19.100276</td>
<td>0.0</td>
<td>22.360248</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>33.540373</td>
<td>22.360248</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>2025020247</td>
<td>"2025-11-09"</td>
<td>"OTT"</td>
<td>"UTA"</td>
<td>"5vE"</td>
<td>2.766667</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.594731</td>
<td>0.609058</td>
<td>0.594731</td>
<td>0.609058</td>
<td>0</td>
<td>4</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>8</td>
<td>1.0</td>
<td>8.0</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>9</td>
<td>1.0</td>
<td>8.0</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>4</td>
<td>1.0</td>
<td>4.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>12.897772</td>
<td>13.208493</td>
<td>12.897772</td>
<td>13.208493</td>
<td>0.0</td>
<td>86.746988</td>
<td>0.0</td>
<td>86.746988</td>
<td>0.0</td>
<td>65.060241</td>
<td>21.686747</td>
<td>173.493976</td>
<td>21.686747</td>
<td>173.493976</td>
<td>0.0</td>
<td>65.060241</td>
<td>43.373494</td>
<td>195.180723</td>
<td>21.686747</td>
<td>173.493976</td>
<td>21.686747</td>
<td>21.686747</td>
<td>0.0</td>
<td>0.0</td>
<td>21.686747</td>
<td>86.746988</td>
<td>21.686747</td>
<td>86.746988</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>21.686747</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.494049</td>
<td>0.494049</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.111111</td>
<td>0.111111</td>
<td>0.0</td>
<td>0.181818</td>
<td>0.111111</td>
<td>0.5</td>
<td>NaN</td>
<td>0.2</td>
<td>0.2</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>2025020092</td>
<td>"2025-10-19"</td>
<td>"UTA"</td>
<td>"BOS"</td>
<td>"5vE"</td>
<td>1.183333</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>2</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>101.408451</td>
<td>50.704225</td>
<td>0.0</td>
<td>0.0</td>
<td>101.408451</td>
<td>50.704225</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>50.704225</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.666667</td>
<td>NaN</td>
<td>0.666667</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

## **Munge the data**

Cleaning the data and prepping for analysis

### Add Home games to the data set

Check to see if team is the home team, adding a dummy column

``` python
home_map = dict(zip(schedule["game_id"], schedule["home_team"], strict=False))

team_stats = team_stats.with_columns(
    is_home=pl.when(pl.col("game_id").replace_strict(home_map, return_dtype=str) == pl.col("team"))
    .then(pl.lit(1))
    .otherwise(pl.lit(0))
)
```

### Aggregate strength state

Add a column to aggregate strength states (e.g., powerplay for 5v4, 5v3,
and 4v3)

``` python
team_stats = aggregate_strength_states(team_stats)
```

### Prep overall NHL stats

Function to calculate the goals scored and allowed above the expected
goals model, at the overall NHL season level, adjusted for score and
venue

``` python
nhl_stats = prep_nhl_stats(team_stats)
```

``` python
nhl_stats.head(5)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 81)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">session</th>
<th data-quarto-table-cell-role="th">is_home</th>
<th data-quarto-table-cell-role="th">strength_state2</th>
<th data-quarto-table-cell-role="th">toi</th>
<th data-quarto-table-cell-role="th">gf</th>
<th data-quarto-table-cell-role="th">ga</th>
<th data-quarto-table-cell-role="th">gf_adj</th>
<th data-quarto-table-cell-role="th">ga_adj</th>
<th data-quarto-table-cell-role="th">hdgf</th>
<th data-quarto-table-cell-role="th">hdga</th>
<th data-quarto-table-cell-role="th">xgf</th>
<th data-quarto-table-cell-role="th">xga</th>
<th data-quarto-table-cell-role="th">xgf_adj</th>
<th data-quarto-table-cell-role="th">xga_adj</th>
<th data-quarto-table-cell-role="th">sf</th>
<th data-quarto-table-cell-role="th">sa</th>
<th data-quarto-table-cell-role="th">sf_adj</th>
<th data-quarto-table-cell-role="th">sa_adj</th>
<th data-quarto-table-cell-role="th">hdsf</th>
<th data-quarto-table-cell-role="th">hdsa</th>
<th data-quarto-table-cell-role="th">ff</th>
<th data-quarto-table-cell-role="th">fa</th>
<th data-quarto-table-cell-role="th">ff_adj</th>
<th data-quarto-table-cell-role="th">fa_adj</th>
<th data-quarto-table-cell-role="th">hdff</th>
<th data-quarto-table-cell-role="th">hdfa</th>
<th data-quarto-table-cell-role="th">cf</th>
<th data-quarto-table-cell-role="th">ca</th>
<th data-quarto-table-cell-role="th">cf_adj</th>
<th data-quarto-table-cell-role="th">ca_adj</th>
<th data-quarto-table-cell-role="th">bsf</th>
<th data-quarto-table-cell-role="th">bsa</th>
<th data-quarto-table-cell-role="th">bsf_adj</th>
<th data-quarto-table-cell-role="th">bsa_adj</th>
<th data-quarto-table-cell-role="th">msf</th>
<th data-quarto-table-cell-role="th">msa</th>
<th data-quarto-table-cell-role="th">msf_adj</th>
<th data-quarto-table-cell-role="th">msa_adj</th>
<th data-quarto-table-cell-role="th">hdmsf</th>
<th data-quarto-table-cell-role="th">hdmsa</th>
<th data-quarto-table-cell-role="th">teammate_block</th>
<th data-quarto-table-cell-role="th">hf</th>
<th data-quarto-table-cell-role="th">ht</th>
<th data-quarto-table-cell-role="th">give</th>
<th data-quarto-table-cell-role="th">take</th>
<th data-quarto-table-cell-role="th">ozf</th>
<th data-quarto-table-cell-role="th">nzf</th>
<th data-quarto-table-cell-role="th">dzf</th>
<th data-quarto-table-cell-role="th">fow</th>
<th data-quarto-table-cell-role="th">fol</th>
<th data-quarto-table-cell-role="th">ozfw</th>
<th data-quarto-table-cell-role="th">ozfl</th>
<th data-quarto-table-cell-role="th">nzfw</th>
<th data-quarto-table-cell-role="th">nzfl</th>
<th data-quarto-table-cell-role="th">dzfw</th>
<th data-quarto-table-cell-role="th">dzfl</th>
<th data-quarto-table-cell-role="th">pent0</th>
<th data-quarto-table-cell-role="th">pent2</th>
<th data-quarto-table-cell-role="th">pent4</th>
<th data-quarto-table-cell-role="th">pent5</th>
<th data-quarto-table-cell-role="th">pent10</th>
<th data-quarto-table-cell-role="th">pend0</th>
<th data-quarto-table-cell-role="th">pend2</th>
<th data-quarto-table-cell-role="th">pend4</th>
<th data-quarto-table-cell-role="th">pend5</th>
<th data-quarto-table-cell-role="th">pend10</th>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">g_score_ax</th>
<th data-quarto-table-cell-role="th">g_save_ax</th>
<th data-quarto-table-cell-role="th">toi_gp</th>
<th data-quarto-table-cell-role="th">gf_p60</th>
<th data-quarto-table-cell-role="th">ga_p60</th>
<th data-quarto-table-cell-role="th">gf_adj_p60</th>
<th data-quarto-table-cell-role="th">ga_adj_p60</th>
<th data-quarto-table-cell-role="th">xgf_p60</th>
<th data-quarto-table-cell-role="th">xga_p60</th>
<th data-quarto-table-cell-role="th">xgf_adj_p60</th>
<th data-quarto-table-cell-role="th">xga_adj_p60</th>
<th data-quarto-table-cell-role="th">g_score_ax_p60</th>
<th data-quarto-table-cell-role="th">g_save_ax_p60</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>i32</th>
<th>str</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>u32</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>0</td>
<td>"Ev5"</td>
<td>536.35</td>
<td>57</td>
<td>166</td>
<td>57.0</td>
<td>166.0</td>
<td>20</td>
<td>37</td>
<td>69.020614</td>
<td>179.961909</td>
<td>69.020614</td>
<td>179.961909</td>
<td>494</td>
<td>166</td>
<td>494.0</td>
<td>166.0</td>
<td>159</td>
<td>37</td>
<td>794</td>
<td>307</td>
<td>794.0</td>
<td>306.0</td>
<td>228</td>
<td>37</td>
<td>1150</td>
<td>418</td>
<td>794.0</td>
<td>306.0</td>
<td>318</td>
<td>111</td>
<td>0.0</td>
<td>0.0</td>
<td>300</td>
<td>141</td>
<td>300.0</td>
<td>140.0</td>
<td>69</td>
<td>0</td>
<td>38</td>
<td>67</td>
<td>94</td>
<td>109</td>
<td>24</td>
<td>262</td>
<td>29</td>
<td>211</td>
<td>274</td>
<td>228</td>
<td>262</td>
<td>0</td>
<td>12</td>
<td>17</td>
<td>0</td>
<td>211</td>
<td>0</td>
<td>23</td>
<td>0</td>
<td>3</td>
<td>6</td>
<td>0</td>
<td>332</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>483</td>
<td>-12.020614</td>
<td>13.961909</td>
<td>1.110455</td>
<td>6.376433</td>
<td>18.569964</td>
<td>6.376433</td>
<td>18.569964</td>
<td>7.721146</td>
<td>20.131844</td>
<td>7.721146</td>
<td>20.131844</td>
<td>-1.344713</td>
<td>1.56188</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>0</td>
<td>"3vE"</td>
<td>2.5</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1.110907</td>
<td>0.0</td>
<td>1.110907</td>
<td>0</td>
<td>6</td>
<td>0.0</td>
<td>6.0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>8</td>
<td>0.0</td>
<td>8.0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>9</td>
<td>0.0</td>
<td>8.0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>9</td>
<td>0.0</td>
<td>1.110907</td>
<td>0.277778</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>26.661775</td>
<td>0.0</td>
<td>26.661775</td>
<td>0.0</td>
<td>26.661775</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>0</td>
<td>"Ev4"</td>
<td>40.0</td>
<td>9</td>
<td>10</td>
<td>9.0</td>
<td>10.0</td>
<td>3</td>
<td>2</td>
<td>8.10169</td>
<td>7.612753</td>
<td>8.10169</td>
<td>7.612753</td>
<td>45</td>
<td>10</td>
<td>45.0</td>
<td>10.0</td>
<td>7</td>
<td>2</td>
<td>78</td>
<td>15</td>
<td>78.0</td>
<td>15.0</td>
<td>12</td>
<td>2</td>
<td>111</td>
<td>22</td>
<td>78.0</td>
<td>15.0</td>
<td>28</td>
<td>7</td>
<td>0.0</td>
<td>0.0</td>
<td>33</td>
<td>5</td>
<td>33.0</td>
<td>5.0</td>
<td>5</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>4</td>
<td>5</td>
<td>2</td>
<td>34</td>
<td>1</td>
<td>13</td>
<td>34</td>
<td>14</td>
<td>34</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>13</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>8</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>53</td>
<td>0.89831</td>
<td>-2.387247</td>
<td>0.754717</td>
<td>13.5</td>
<td>15.0</td>
<td>13.5</td>
<td>15.0</td>
<td>12.152535</td>
<td>11.419129</td>
<td>12.152535</td>
<td>11.419129</td>
<td>1.347465</td>
<td>-3.580871</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>0</td>
<td>"powerplay"</td>
<td>4105.033333</td>
<td>514</td>
<td>49</td>
<td>555.923431</td>
<td>51.608182</td>
<td>222</td>
<td>26</td>
<td>632.442075</td>
<td>50.900359</td>
<td>685.593593</td>
<td>47.745515</td>
<td>3541</td>
<td>625</td>
<td>3757.638052</td>
<td>659.030873</td>
<td>1103</td>
<td>119</td>
<td>5362</td>
<td>793</td>
<td>5728.852631</td>
<td>842.420465</td>
<td>1592</td>
<td>150</td>
<td>6988</td>
<td>891</td>
<td>5728.852631</td>
<td>842.420465</td>
<td>1463</td>
<td>98</td>
<td>0.0</td>
<td>0.0</td>
<td>1821</td>
<td>168</td>
<td>1945.086182</td>
<td>158.628621</td>
<td>489</td>
<td>31</td>
<td>163</td>
<td>179</td>
<td>517</td>
<td>823</td>
<td>174</td>
<td>1943</td>
<td>624</td>
<td>1732</td>
<td>2334</td>
<td>1965</td>
<td>1888</td>
<td>55</td>
<td>347</td>
<td>277</td>
<td>99</td>
<td>1633</td>
<td>4</td>
<td>154</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>87</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>883</td>
<td>-129.670162</td>
<td>-3.862667</td>
<td>4.648962</td>
<td>7.512728</td>
<td>0.716194</td>
<td>8.12549</td>
<td>0.754316</td>
<td>9.243902</td>
<td>0.74397</td>
<td>10.020775</td>
<td>0.697858</td>
<td>-1.895285</td>
<td>-0.056458</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>1</td>
<td>"ILLEGAL"</td>
<td>1.9</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>19</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>

### Prep team stats

Function to prep and aggregate team stats to match up with the schedule
for predicting the game’s values

``` python
team_stats_agg = prep_team_stats(team_stats=team_stats, nhl_stats=nhl_stats, latest_date=latest_date)
```

``` python
team_stats_agg.head(5)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 98)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">session</th>
<th data-quarto-table-cell-role="th">team</th>
<th data-quarto-table-cell-role="th">is_home</th>
<th data-quarto-table-cell-role="th">strength_state2</th>
<th data-quarto-table-cell-role="th">toi</th>
<th data-quarto-table-cell-role="th">gf</th>
<th data-quarto-table-cell-role="th">ga</th>
<th data-quarto-table-cell-role="th">gf_adj</th>
<th data-quarto-table-cell-role="th">ga_adj</th>
<th data-quarto-table-cell-role="th">hdgf</th>
<th data-quarto-table-cell-role="th">hdga</th>
<th data-quarto-table-cell-role="th">xgf</th>
<th data-quarto-table-cell-role="th">xga</th>
<th data-quarto-table-cell-role="th">xgf_adj</th>
<th data-quarto-table-cell-role="th">xga_adj</th>
<th data-quarto-table-cell-role="th">sf</th>
<th data-quarto-table-cell-role="th">sa</th>
<th data-quarto-table-cell-role="th">sf_adj</th>
<th data-quarto-table-cell-role="th">sa_adj</th>
<th data-quarto-table-cell-role="th">hdsf</th>
<th data-quarto-table-cell-role="th">hdsa</th>
<th data-quarto-table-cell-role="th">ff</th>
<th data-quarto-table-cell-role="th">fa</th>
<th data-quarto-table-cell-role="th">ff_adj</th>
<th data-quarto-table-cell-role="th">fa_adj</th>
<th data-quarto-table-cell-role="th">hdff</th>
<th data-quarto-table-cell-role="th">hdfa</th>
<th data-quarto-table-cell-role="th">cf</th>
<th data-quarto-table-cell-role="th">ca</th>
<th data-quarto-table-cell-role="th">cf_adj</th>
<th data-quarto-table-cell-role="th">ca_adj</th>
<th data-quarto-table-cell-role="th">bsf</th>
<th data-quarto-table-cell-role="th">bsa</th>
<th data-quarto-table-cell-role="th">bsf_adj</th>
<th data-quarto-table-cell-role="th">bsa_adj</th>
<th data-quarto-table-cell-role="th">msf</th>
<th data-quarto-table-cell-role="th">msa</th>
<th data-quarto-table-cell-role="th">msf_adj</th>
<th data-quarto-table-cell-role="th">msa_adj</th>
<th data-quarto-table-cell-role="th">hdmsf</th>
<th data-quarto-table-cell-role="th">hdmsa</th>
<th data-quarto-table-cell-role="th">teammate_block</th>
<th data-quarto-table-cell-role="th">hf</th>
<th data-quarto-table-cell-role="th">ht</th>
<th data-quarto-table-cell-role="th">give</th>
<th data-quarto-table-cell-role="th">take</th>
<th data-quarto-table-cell-role="th">ozf</th>
<th data-quarto-table-cell-role="th">nzf</th>
<th data-quarto-table-cell-role="th">dzf</th>
<th data-quarto-table-cell-role="th">fow</th>
<th data-quarto-table-cell-role="th">fol</th>
<th data-quarto-table-cell-role="th">ozfw</th>
<th data-quarto-table-cell-role="th">ozfl</th>
<th data-quarto-table-cell-role="th">nzfw</th>
<th data-quarto-table-cell-role="th">nzfl</th>
<th data-quarto-table-cell-role="th">dzfw</th>
<th data-quarto-table-cell-role="th">dzfl</th>
<th data-quarto-table-cell-role="th">pent0</th>
<th data-quarto-table-cell-role="th">pent2</th>
<th data-quarto-table-cell-role="th">pent4</th>
<th data-quarto-table-cell-role="th">pent5</th>
<th data-quarto-table-cell-role="th">pent10</th>
<th data-quarto-table-cell-role="th">pend0</th>
<th data-quarto-table-cell-role="th">pend2</th>
<th data-quarto-table-cell-role="th">pend4</th>
<th data-quarto-table-cell-role="th">pend5</th>
<th data-quarto-table-cell-role="th">pend10</th>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">g_score_ax</th>
<th data-quarto-table-cell-role="th">g_save_ax</th>
<th data-quarto-table-cell-role="th">toi_gp</th>
<th data-quarto-table-cell-role="th">gf_p60</th>
<th data-quarto-table-cell-role="th">ga_p60</th>
<th data-quarto-table-cell-role="th">gf_adj_p60</th>
<th data-quarto-table-cell-role="th">ga_adj_p60</th>
<th data-quarto-table-cell-role="th">xgf_p60</th>
<th data-quarto-table-cell-role="th">xga_p60</th>
<th data-quarto-table-cell-role="th">xgf_adj_p60</th>
<th data-quarto-table-cell-role="th">xga_adj_p60</th>
<th data-quarto-table-cell-role="th">g_score_ax_p60</th>
<th data-quarto-table-cell-role="th">g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_xgf_p60</th>
<th data-quarto-table-cell-role="th">mean_xga_p60</th>
<th data-quarto-table-cell-role="th">mean_xgf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_xga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_gf_p60</th>
<th data-quarto-table-cell-role="th">mean_ga_p60</th>
<th data-quarto-table-cell-role="th">mean_gf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_ga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_g_score_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_toi_gp</th>
<th data-quarto-table-cell-role="th">off_strength</th>
<th data-quarto-table-cell-role="th">def_strength</th>
<th data-quarto-table-cell-role="th">toi_comparison</th>
<th data-quarto-table-cell-role="th">scoring_strength</th>
<th data-quarto-table-cell-role="th">goalie_strength</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>i32</th>
<th>str</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>u32</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>"CBJ"</td>
<td>1</td>
<td>"4vE"</td>
<td>0.866667</td>
<td>1</td>
<td>0</td>
<td>1.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.61581</td>
<td>0.049193</td>
<td>0.61581</td>
<td>0.049193</td>
<td>1</td>
<td>1</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1.0</td>
<td>1.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.38419</td>
<td>0.049193</td>
<td>0.866667</td>
<td>69.230769</td>
<td>0.0</td>
<td>69.230769</td>
<td>0.0</td>
<td>42.63297</td>
<td>3.405685</td>
<td>42.63297</td>
<td>3.405685</td>
<td>26.5978</td>
<td>3.405685</td>
<td>11.419129</td>
<td>12.152535</td>
<td>11.419129</td>
<td>12.152535</td>
<td>15.0</td>
<td>13.5</td>
<td>15.0</td>
<td>13.5</td>
<td>3.580871</td>
<td>-1.347465</td>
<td>0.754717</td>
<td>3.733469</td>
<td>0.280245</td>
<td>1.148333</td>
<td>7.427746</td>
<td>-2.527476</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>"NSH"</td>
<td>1</td>
<td>"4vE"</td>
<td>1.766667</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>1.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.13276</td>
<td>0.0</td>
<td>0.13276</td>
<td>0</td>
<td>2</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>0.0</td>
<td>4.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2</td>
<td>0.0</td>
<td>2.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0.0</td>
<td>-0.86724</td>
<td>0.883333</td>
<td>0.0</td>
<td>33.962264</td>
<td>0.0</td>
<td>33.962264</td>
<td>0.0</td>
<td>4.508823</td>
<td>0.0</td>
<td>4.508823</td>
<td>0.0</td>
<td>-29.453441</td>
<td>11.419129</td>
<td>12.152535</td>
<td>11.419129</td>
<td>12.152535</td>
<td>15.0</td>
<td>13.5</td>
<td>15.0</td>
<td>13.5</td>
<td>3.580871</td>
<td>-1.347465</td>
<td>0.754717</td>
<td>0.0</td>
<td>0.371019</td>
<td>1.170417</td>
<td>0.0</td>
<td>21.858415</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>"DAL"</td>
<td>0</td>
<td>"ILLEGAL"</td>
<td>0.383333</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>0.0</td>
<td>0.0</td>
<td>0.127778</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>NaN</td>
<td>NaN</td>
<td>1.277778</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>"PHI"</td>
<td>0</td>
<td>"ILLEGAL"</td>
<td>0.083333</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.083333</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.833333</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td>20252026</td>
<td>"R"</td>
<td>"NJD"</td>
<td>0</td>
<td>"shorthanded"</td>
<td>120.933333</td>
<td>2</td>
<td>16</td>
<td>1.737288</td>
<td>15.06796</td>
<td>0</td>
<td>6</td>
<td>1.977491</td>
<td>20.020203</td>
<td>2.213706</td>
<td>18.863242</td>
<td>17</td>
<td>116</td>
<td>16.053371</td>
<td>110.466815</td>
<td>6</td>
<td>33</td>
<td>24</td>
<td>171</td>
<td>22.643352</td>
<td>162.09692</td>
<td>6</td>
<td>52</td>
<td>27</td>
<td>213</td>
<td>22.643352</td>
<td>162.09692</td>
<td>3</td>
<td>42</td>
<td>0.0</td>
<td>0.0</td>
<td>7</td>
<td>55</td>
<td>7.463236</td>
<td>52.44747</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>13</td>
<td>7</td>
<td>19</td>
<td>11</td>
<td>73</td>
<td>18</td>
<td>58</td>
<td>64</td>
<td>85</td>
<td>2</td>
<td>71</td>
<td>6</td>
<td>12</td>
<td>56</td>
<td>2</td>
<td>0</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>26</td>
<td>-0.476418</td>
<td>3.795282</td>
<td>4.651282</td>
<td>0.992282</td>
<td>7.938258</td>
<td>0.86194</td>
<td>7.475834</td>
<td>0.981115</td>
<td>9.932846</td>
<td>1.098311</td>
<td>9.35883</td>
<td>-0.236371</td>
<td>1.882996</td>
<td>0.755118</td>
<td>9.38011</td>
<td>0.826901</td>
<td>8.675806</td>
<td>0.892854</td>
<td>7.649225</td>
<td>0.836282</td>
<td>7.069986</td>
<td>0.009381</td>
<td>1.60582</td>
<td>5.064586</td>
<td>1.328225</td>
<td>1.078727</td>
<td>0.918393</td>
<td>-25.197613</td>
<td>1.172607</td>
</tr>
</tbody>
</table>

</div>

### Prep today’s games

Function to prepare today’s games

``` python
todays_games = prep_todays_games(schedule=schedule, team_stats=team_stats, nhl_stats=nhl_stats, latest_date=latest_date)
```

``` python
todays_games.head(5)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 128)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">session</th>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">game_date</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">game_state</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">home_team_id</th>
<th data-quarto-table-cell-role="th">home_score</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">away_team_id</th>
<th data-quarto-table-cell-role="th">away_score</th>
<th data-quarto-table-cell-role="th">venue</th>
<th data-quarto-table-cell-role="th">venue_timezone</th>
<th data-quarto-table-cell-role="th">neutral_site</th>
<th data-quarto-table-cell-role="th">game_date_dt_utc</th>
<th data-quarto-table-cell-role="th">tv_broadcasts</th>
<th data-quarto-table-cell-role="th">home_logo</th>
<th data-quarto-table-cell-role="th">home_logo_dark</th>
<th data-quarto-table-cell-role="th">away_logo</th>
<th data-quarto-table-cell-role="th">away_logo_dark</th>
<th data-quarto-table-cell-role="th">home_5v5_off_strength</th>
<th data-quarto-table-cell-role="th">home_5v5_def_strength</th>
<th data-quarto-table-cell-role="th">home_5v5_scoring_strength</th>
<th data-quarto-table-cell-role="th">home_5v5_goalie_strength</th>
<th data-quarto-table-cell-role="th">home_5v5_toi_comparison</th>
<th data-quarto-table-cell-role="th">home_powerplay_off_strength</th>
<th
data-quarto-table-cell-role="th">home_powerplay_scoring_strength</th>
<th data-quarto-table-cell-role="th">home_powerplay_toi_comparison</th>
<th data-quarto-table-cell-role="th">home_shorthanded_def_strength</th>
<th
data-quarto-table-cell-role="th">home_shorthanded_goalie_strength</th>
<th
data-quarto-table-cell-role="th">home_shorthanded_toi_comparison</th>
<th data-quarto-table-cell-role="th">away_5v5_off_strength</th>
<th data-quarto-table-cell-role="th">away_5v5_def_strength</th>
<th data-quarto-table-cell-role="th">away_5v5_scoring_strength</th>
<th data-quarto-table-cell-role="th">away_5v5_goalie_strength</th>
<th data-quarto-table-cell-role="th">away_5v5_toi_comparison</th>
<th data-quarto-table-cell-role="th">away_powerplay_off_strength</th>
<th
data-quarto-table-cell-role="th">away_powerplay_scoring_strength</th>
<th data-quarto-table-cell-role="th">away_powerplay_toi_comparison</th>
<th data-quarto-table-cell-role="th">away_shorthanded_def_strength</th>
<th
data-quarto-table-cell-role="th">away_shorthanded_goalie_strength</th>
<th
data-quarto-table-cell-role="th">away_shorthanded_toi_comparison</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_xgf_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_xga_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_xgf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_xga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_ga_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_gf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_ga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_g_score_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_home_5v5_toi_gp</th>
<th data-quarto-table-cell-role="th">mean_home_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">mean_home_powerplay_xga_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_powerplay_xgf_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_powerplay_xga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_home_powerplay_gf_p60</th>
<th data-quarto-table-cell-role="th">mean_home_powerplay_ga_p60</th>
<th data-quarto-table-cell-role="th">mean_home_powerplay_gf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_home_powerplay_ga_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_powerplay_g_score_ax_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_powerplay_g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_home_powerplay_toi_gp</th>
<th data-quarto-table-cell-role="th">mean_home_shorthanded_xgf_p60</th>
<th data-quarto-table-cell-role="th">mean_home_shorthanded_xga_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_shorthanded_xgf_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_shorthanded_xga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_home_shorthanded_gf_p60</th>
<th data-quarto-table-cell-role="th">mean_home_shorthanded_ga_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_shorthanded_gf_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_shorthanded_ga_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_shorthanded_g_score_ax_p60</th>
<th
data-quarto-table-cell-role="th">mean_home_shorthanded_g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_home_shorthanded_toi_gp</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_xgf_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_xga_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_xgf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_xga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_ga_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_gf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_ga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_g_score_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_away_5v5_toi_gp</th>
<th data-quarto-table-cell-role="th">mean_away_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">mean_away_powerplay_xga_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_powerplay_xgf_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_powerplay_xga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_away_powerplay_gf_p60</th>
<th data-quarto-table-cell-role="th">mean_away_powerplay_ga_p60</th>
<th data-quarto-table-cell-role="th">mean_away_powerplay_gf_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_away_powerplay_ga_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_powerplay_g_score_ax_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_powerplay_g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_away_powerplay_toi_gp</th>
<th data-quarto-table-cell-role="th">mean_away_shorthanded_xgf_p60</th>
<th data-quarto-table-cell-role="th">mean_away_shorthanded_xga_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_shorthanded_xgf_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_shorthanded_xga_adj_p60</th>
<th data-quarto-table-cell-role="th">mean_away_shorthanded_gf_p60</th>
<th data-quarto-table-cell-role="th">mean_away_shorthanded_ga_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_shorthanded_gf_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_shorthanded_ga_adj_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_shorthanded_g_score_ax_p60</th>
<th
data-quarto-table-cell-role="th">mean_away_shorthanded_g_save_ax_p60</th>
<th data-quarto-table-cell-role="th">mean_away_shorthanded_toi_gp</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_powerplay_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_shorthanded_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_xga_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_ga_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_shorthanded_xga_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_shorthanded_ga_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_xga_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_ga_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_shorthanded_xga_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_shorthanded_ga_p60</th>
</tr>
<tr>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>datetime[μs, UTC]</th>
<th>list[struct[5]]</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>20252026</td>
<td>2</td>
<td>2025020810</td>
<td>"2026-01-24"</td>
<td>"13:00"</td>
<td>"OFF"</td>
<td>"NYI"</td>
<td>2</td>
<td>0</td>
<td>"BUF"</td>
<td>7</td>
<td>5</td>
<td>"UBS ARENA"</td>
<td>"America/New_York"</td>
<td>0</td>
<td>2026-01-24 18:00:00 UTC</td>
<td>[{282,"N","CA","SN",107}, {28,"A","US","MSG-B",392},
{409,"H","US","MSGSN",411}]</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>1.032099</td>
<td>1.098022</td>
<td>1.215772</td>
<td>2.5018</td>
<td>0.998547</td>
<td>1.019476</td>
<td>1.519422</td>
<td>1.078344</td>
<td>1.166022</td>
<td>2.812028</td>
<td>0.972322</td>
<td>1.013831</td>
<td>0.959593</td>
<td>1.192254</td>
<td>0.226348</td>
<td>1.002412</td>
<td>1.015596</td>
<td>2.379345</td>
<td>1.059298</td>
<td>0.962996</td>
<td>1.663244</td>
<td>0.847453</td>
<td>2.941164</td>
<td>2.728581</td>
<td>2.816787</td>
<td>2.851487</td>
<td>2.533148</td>
<td>2.485146</td>
<td>2.43756</td>
<td>2.566546</td>
<td>-0.379227</td>
<td>0.28494</td>
<td>48.501035</td>
<td>9.38011</td>
<td>0.755118</td>
<td>8.675806</td>
<td>0.826901</td>
<td>7.649225</td>
<td>0.892854</td>
<td>7.069986</td>
<td>0.836282</td>
<td>-1.60582</td>
<td>-0.009381</td>
<td>5.064586</td>
<td>0.74397</td>
<td>9.243902</td>
<td>0.697858</td>
<td>10.020775</td>
<td>0.686962</td>
<td>7.512728</td>
<td>0.754316</td>
<td>8.12549</td>
<td>0.056458</td>
<td>1.895285</td>
<td>4.648962</td>
<td>2.728581</td>
<td>2.941164</td>
<td>2.851487</td>
<td>2.816787</td>
<td>2.483774</td>
<td>2.535891</td>
<td>2.566546</td>
<td>2.43756</td>
<td>-0.28494</td>
<td>0.379227</td>
<td>48.501035</td>
<td>9.243902</td>
<td>0.74397</td>
<td>10.020775</td>
<td>0.697858</td>
<td>7.512728</td>
<td>0.716194</td>
<td>8.12549</td>
<td>0.754316</td>
<td>-1.895285</td>
<td>-0.056458</td>
<td>4.648962</td>
<td>0.755118</td>
<td>9.38011</td>
<td>0.826901</td>
<td>8.675806</td>
<td>0.892854</td>
<td>7.649225</td>
<td>0.836282</td>
<td>7.069986</td>
<td>0.009381</td>
<td>1.60582</td>
<td>5.064586</td>
<td>48.547351</td>
<td>4.628251</td>
<td>4.788336</td>
<td>2.789734</td>
<td>3.174302</td>
<td>0.664344</td>
<td>8.522113</td>
<td>8.51749</td>
<td>17.541011</td>
<td>11.866671</td>
<td>64.38049</td>
<td>3.174302</td>
<td>2.789734</td>
<td>8.522113</td>
<td>0.664344</td>
<td>11.866671</td>
<td>64.38049</td>
<td>8.51749</td>
<td>17.541011</td>
</tr>
<tr>
<td>20252026</td>
<td>2</td>
<td>2025020811</td>
<td>"2026-01-24"</td>
<td>"12:30"</td>
<td>"OFF"</td>
<td>"NSH"</td>
<td>18</td>
<td>2</td>
<td>"UTA"</td>
<td>68</td>
<td>5</td>
<td>"BRIDGESTONE ARENA"</td>
<td>"US/Central"</td>
<td>0</td>
<td>2026-01-24 18:30:00 UTC</td>
<td>[{282,"N","CA","SN",107}, {284,"N","CA","SN1",113}, …
{558,"A","US","Utah16",381}]</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>1.029662</td>
<td>0.983516</td>
<td>2.188479</td>
<td>-0.431273</td>
<td>0.978291</td>
<td>0.817146</td>
<td>0.418178</td>
<td>0.987613</td>
<td>0.86872</td>
<td>2.024623</td>
<td>1.145351</td>
<td>1.072654</td>
<td>0.912573</td>
<td>1.046681</td>
<td>0.277726</td>
<td>1.004538</td>
<td>0.78517</td>
<td>0.944735</td>
<td>1.00629</td>
<td>0.908922</td>
<td>1.070264</td>
<td>1.009018</td>
<td>2.941164</td>
<td>2.728581</td>
<td>2.816787</td>
<td>2.851487</td>
<td>2.533148</td>
<td>2.485146</td>
<td>2.43756</td>
<td>2.566546</td>
<td>-0.379227</td>
<td>0.28494</td>
<td>48.501035</td>
<td>9.38011</td>
<td>0.755118</td>
<td>8.675806</td>
<td>0.826901</td>
<td>7.649225</td>
<td>0.892854</td>
<td>7.069986</td>
<td>0.836282</td>
<td>-1.60582</td>
<td>-0.009381</td>
<td>5.064586</td>
<td>0.74397</td>
<td>9.243902</td>
<td>0.697858</td>
<td>10.020775</td>
<td>0.686962</td>
<td>7.512728</td>
<td>0.754316</td>
<td>8.12549</td>
<td>0.056458</td>
<td>1.895285</td>
<td>4.648962</td>
<td>2.728581</td>
<td>2.941164</td>
<td>2.851487</td>
<td>2.816787</td>
<td>2.483774</td>
<td>2.535891</td>
<td>2.566546</td>
<td>2.43756</td>
<td>-0.28494</td>
<td>0.379227</td>
<td>48.501035</td>
<td>9.243902</td>
<td>0.74397</td>
<td>10.020775</td>
<td>0.697858</td>
<td>7.512728</td>
<td>0.716194</td>
<td>8.12549</td>
<td>0.754316</td>
<td>-1.895285</td>
<td>-0.056458</td>
<td>4.648962</td>
<td>0.755118</td>
<td>9.38011</td>
<td>0.826901</td>
<td>8.675806</td>
<td>0.892854</td>
<td>7.649225</td>
<td>0.836282</td>
<td>7.069986</td>
<td>0.009381</td>
<td>1.60582</td>
<td>5.064586</td>
<td>47.663489</td>
<td>5.046957</td>
<td>5.358185</td>
<td>2.646771</td>
<td>3.008242</td>
<td>1.392119</td>
<td>-1.22224</td>
<td>6.443714</td>
<td>2.350161</td>
<td>6.835096</td>
<td>10.601006</td>
<td>3.008242</td>
<td>2.646771</td>
<td>-1.22224</td>
<td>1.392119</td>
<td>6.835096</td>
<td>10.601006</td>
<td>6.443714</td>
<td>2.350161</td>
</tr>
<tr>
<td>20252026</td>
<td>2</td>
<td>2025020812</td>
<td>"2026-01-24"</td>
<td>"19:00"</td>
<td>"OFF"</td>
<td>"BOS"</td>
<td>6</td>
<td>4</td>
<td>"MTL"</td>
<td>8</td>
<td>3</td>
<td>"TD GARDEN"</td>
<td>"US/Eastern"</td>
<td>0</td>
<td>2026-01-25 00:00:00 UTC</td>
<td>[{287,"N","CA","SNE",30}, {288,"N","CA","SNO",31}, …
{31,"H","US","NESN",405}]</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>0.985353</td>
<td>1.063828</td>
<td>0.149162</td>
<td>2.623023</td>
<td>0.977731</td>
<td>0.945022</td>
<td>-0.130636</td>
<td>1.008577</td>
<td>1.088831</td>
<td>1.718694</td>
<td>1.165002</td>
<td>0.888426</td>
<td>0.943972</td>
<td>-0.718902</td>
<td>1.236217</td>
<td>0.976611</td>
<td>1.072128</td>
<td>-0.141762</td>
<td>1.132869</td>
<td>1.026001</td>
<td>0.702074</td>
<td>1.108745</td>
<td>2.941164</td>
<td>2.728581</td>
<td>2.816787</td>
<td>2.851487</td>
<td>2.533148</td>
<td>2.485146</td>
<td>2.43756</td>
<td>2.566546</td>
<td>-0.379227</td>
<td>0.28494</td>
<td>48.501035</td>
<td>9.38011</td>
<td>0.755118</td>
<td>8.675806</td>
<td>0.826901</td>
<td>7.649225</td>
<td>0.892854</td>
<td>7.069986</td>
<td>0.836282</td>
<td>-1.60582</td>
<td>-0.009381</td>
<td>5.064586</td>
<td>0.74397</td>
<td>9.243902</td>
<td>0.697858</td>
<td>10.020775</td>
<td>0.686962</td>
<td>7.512728</td>
<td>0.754316</td>
<td>8.12549</td>
<td>0.056458</td>
<td>1.895285</td>
<td>4.648962</td>
<td>2.728581</td>
<td>2.941164</td>
<td>2.851487</td>
<td>2.816787</td>
<td>2.483774</td>
<td>2.535891</td>
<td>2.566546</td>
<td>2.43756</td>
<td>-0.28494</td>
<td>0.379227</td>
<td>48.501035</td>
<td>9.243902</td>
<td>0.74397</td>
<td>10.020775</td>
<td>0.697858</td>
<td>7.512728</td>
<td>0.716194</td>
<td>8.12549</td>
<td>0.754316</td>
<td>-1.895285</td>
<td>-0.056458</td>
<td>4.648962</td>
<td>0.755118</td>
<td>9.38011</td>
<td>0.826901</td>
<td>8.675806</td>
<td>0.892854</td>
<td>7.649225</td>
<td>0.836282</td>
<td>7.069986</td>
<td>0.009381</td>
<td>1.60582</td>
<td>5.064586</td>
<td>46.31188</td>
<td>5.663496</td>
<td>6.135677</td>
<td>2.620023</td>
<td>2.695034</td>
<td>0.418081</td>
<td>-4.574184</td>
<td>8.412006</td>
<td>-0.628717</td>
<td>11.697909</td>
<td>-2.311086</td>
<td>2.695034</td>
<td>2.620023</td>
<td>-4.574184</td>
<td>0.418081</td>
<td>11.697909</td>
<td>-2.311086</td>
<td>8.412006</td>
<td>-0.628717</td>
</tr>
<tr>
<td>20252026</td>
<td>2</td>
<td>2025020813</td>
<td>"2026-01-24"</td>
<td>"19:00"</td>
<td>"OFF"</td>
<td>"OTT"</td>
<td>9</td>
<td>1</td>
<td>"CAR"</td>
<td>12</td>
<td>4</td>
<td>"CANADIAN TIRE CENTRE"</td>
<td>"US/Eastern"</td>
<td>0</td>
<td>2026-01-25 00:00:00 UTC</td>
<td>[{284,"N","CA","SN1",113}, {286,"N","CA","CITY",137},
{561,"A","US","FDSNSO",202}]</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>0.991645</td>
<td>0.818598</td>
<td>1.545365</td>
<td>-0.907254</td>
<td>0.968379</td>
<td>0.89586</td>
<td>-0.503662</td>
<td>1.15124</td>
<td>0.725061</td>
<td>-0.22982</td>
<td>1.058032</td>
<td>1.198828</td>
<td>0.966861</td>
<td>2.877418</td>
<td>1.415492</td>
<td>0.993524</td>
<td>0.968843</td>
<td>1.812915</td>
<td>1.140039</td>
<td>0.713705</td>
<td>0.434465</td>
<td>1.074454</td>
<td>2.941164</td>
<td>2.728581</td>
<td>2.816787</td>
<td>2.851487</td>
<td>2.533148</td>
<td>2.485146</td>
<td>2.43756</td>
<td>2.566546</td>
<td>-0.379227</td>
<td>0.28494</td>
<td>48.501035</td>
<td>9.38011</td>
<td>0.755118</td>
<td>8.675806</td>
<td>0.826901</td>
<td>7.649225</td>
<td>0.892854</td>
<td>7.069986</td>
<td>0.836282</td>
<td>-1.60582</td>
<td>-0.009381</td>
<td>5.064586</td>
<td>0.74397</td>
<td>9.243902</td>
<td>0.697858</td>
<td>10.020775</td>
<td>0.686962</td>
<td>7.512728</td>
<td>0.754316</td>
<td>8.12549</td>
<td>0.056458</td>
<td>1.895285</td>
<td>4.648962</td>
<td>2.728581</td>
<td>2.941164</td>
<td>2.851487</td>
<td>2.816787</td>
<td>2.483774</td>
<td>2.535891</td>
<td>2.566546</td>
<td>2.43756</td>
<td>-0.28494</td>
<td>0.379227</td>
<td>48.501035</td>
<td>9.243902</td>
<td>0.74397</td>
<td>10.020775</td>
<td>0.697858</td>
<td>7.512728</td>
<td>0.716194</td>
<td>8.12549</td>
<td>0.754316</td>
<td>-1.895285</td>
<td>-0.056458</td>
<td>4.648962</td>
<td>0.755118</td>
<td>9.38011</td>
<td>0.826901</td>
<td>8.675806</td>
<td>0.892854</td>
<td>7.649225</td>
<td>0.836282</td>
<td>7.069986</td>
<td>0.009381</td>
<td>1.60582</td>
<td>5.064586</td>
<td>46.663215</td>
<td>6.264666</td>
<td>5.607569</td>
<td>2.700687</td>
<td>2.798327</td>
<td>5.112274</td>
<td>-6.57519</td>
<td>5.547136</td>
<td>-0.989171</td>
<td>7.039295</td>
<td>-2.378168</td>
<td>2.798327</td>
<td>2.700687</td>
<td>-6.57519</td>
<td>5.112274</td>
<td>7.039295</td>
<td>-2.378168</td>
<td>5.547136</td>
<td>-0.989171</td>
</tr>
<tr>
<td>20252026</td>
<td>2</td>
<td>2025020814</td>
<td>"2026-01-24"</td>
<td>"19:00"</td>
<td>"OFF"</td>
<td>"CBJ"</td>
<td>29</td>
<td>8</td>
<td>"TBL"</td>
<td>14</td>
<td>5</td>
<td>"NATIONWIDE ARENA"</td>
<td>"US/Eastern"</td>
<td>0</td>
<td>2026-01-25 00:00:00 UTC</td>
<td>[{581,"A","US","The Spot",211}, {565,"H","US","FDSNOH",286}]</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>"https://assets.nhle.com/logos/…</td>
<td>1.010127</td>
<td>1.054735</td>
<td>0.755682</td>
<td>2.576822</td>
<td>1.030619</td>
<td>1.068771</td>
<td>2.476875</td>
<td>0.822706</td>
<td>1.036681</td>
<td>-0.315558</td>
<td>0.956388</td>
<td>1.185417</td>
<td>0.853779</td>
<td>0.201814</td>
<td>1.910094</td>
<td>0.965921</td>
<td>0.948375</td>
<td>0.145274</td>
<td>1.09516</td>
<td>0.959875</td>
<td>2.335107</td>
<td>1.097917</td>
<td>2.941164</td>
<td>2.728581</td>
<td>2.816787</td>
<td>2.851487</td>
<td>2.533148</td>
<td>2.485146</td>
<td>2.43756</td>
<td>2.566546</td>
<td>-0.379227</td>
<td>0.28494</td>
<td>48.501035</td>
<td>9.38011</td>
<td>0.755118</td>
<td>8.675806</td>
<td>0.826901</td>
<td>7.649225</td>
<td>0.892854</td>
<td>7.069986</td>
<td>0.836282</td>
<td>-1.60582</td>
<td>-0.009381</td>
<td>5.064586</td>
<td>0.74397</td>
<td>9.243902</td>
<td>0.697858</td>
<td>10.020775</td>
<td>0.686962</td>
<td>7.512728</td>
<td>0.754316</td>
<td>8.12549</td>
<td>0.056458</td>
<td>1.895285</td>
<td>4.648962</td>
<td>2.728581</td>
<td>2.941164</td>
<td>2.851487</td>
<td>2.816787</td>
<td>2.483774</td>
<td>2.535891</td>
<td>2.566546</td>
<td>2.43756</td>
<td>-0.28494</td>
<td>0.379227</td>
<td>48.501035</td>
<td>9.243902</td>
<td>0.74397</td>
<td>10.020775</td>
<td>0.697858</td>
<td>7.512728</td>
<td>0.716194</td>
<td>8.12549</td>
<td>0.754316</td>
<td>-1.895285</td>
<td>-0.056458</td>
<td>4.648962</td>
<td>0.755118</td>
<td>9.38011</td>
<td>0.826901</td>
<td>8.675806</td>
<td>0.892854</td>
<td>7.649225</td>
<td>0.836282</td>
<td>7.069986</td>
<td>0.009381</td>
<td>1.60582</td>
<td>5.064586</td>
<td>48.282614</td>
<td>4.574653</td>
<td>4.869315</td>
<td>2.429269</td>
<td>3.565215</td>
<td>3.034386</td>
<td>1.668781</td>
<td>8.900392</td>
<td>41.949684</td>
<td>9.852042</td>
<td>-0.36622</td>
<td>3.565215</td>
<td>2.429269</td>
<td>1.668781</td>
<td>3.034386</td>
<td>9.852042</td>
<td>-0.36622</td>
<td>8.900392</td>
<td>41.949684</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

## Simulating the actual games

Functions to simulate the games

### Random float

Generate a random floating number between 0 and 1

def random_float() -\> float: “““Generate a random floating number
between 0 and 1.”“” random_generator = np.random.default_rng()

    # return random_generator.triangular(left=0.0, mode=0.5, right=1.0)
    return random_generator.random()

### Simulating an individual game

Predicts various game values, based on a poissoin distribution

``` python
game = todays_games.filter((pl.col("away_team") == "NSH") | (pl.col("home_team") == "NSH")).to_dicts()[0]
```

``` python
pl.DataFrame(simulate_game(game))  # Showing it as a dataframe just to make it easy
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 26)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_powerplay_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_shorthanded_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_powerplay_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_shorthanded_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_goals</th>
<th data-quarto-table-cell-role="th">predicted_home_powerplay_goals</th>
<th data-quarto-table-cell-role="th">predicted_home_total_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_powerplay_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_total_goals</th>
<th data-quarto-table-cell-role="th">home_win</th>
<th data-quarto-table-cell-role="th">away_win</th>
<th data-quarto-table-cell-role="th">draw</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>43.0</td>
<td>2.0</td>
<td>8.0</td>
<td>43.0</td>
<td>8.0</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>13.0</td>
<td>2.15</td>
<td>0.433333</td>
<td>2.583333</td>
<td>NaN</td>
<td>1.0</td>
<td>18.0</td>
<td>5.0</td>
<td>0.716667</td>
<td>0.666667</td>
<td>1.383333</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>

### Predict an entire game

Predict an entire game based on n number of simulations

``` python
predicted_game = predict_game(game, 100)
```

    Output()

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>

``` python
predicted_game.head(5)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 26)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_powerplay_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_shorthanded_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_powerplay_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_shorthanded_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_goals</th>
<th data-quarto-table-cell-role="th">predicted_home_powerplay_goals</th>
<th data-quarto-table-cell-role="th">predicted_home_total_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_powerplay_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_total_goals</th>
<th data-quarto-table-cell-role="th">home_win</th>
<th data-quarto-table-cell-role="th">away_win</th>
<th data-quarto-table-cell-role="th">draw</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>49.6</td>
<td>4.0</td>
<td>6.4</td>
<td>49.6</td>
<td>6.4</td>
<td>4.0</td>
<td>0.0</td>
<td>3.0</td>
<td>2.0</td>
<td>8.0</td>
<td>2.48</td>
<td>0.533333</td>
<td>3.013333</td>
<td>NaN</td>
<td>1.0</td>
<td>14.0</td>
<td>4.0</td>
<td>0.826667</td>
<td>0.426667</td>
<td>1.253333</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>36.0</td>
<td>3.0</td>
<td>4.0</td>
<td>36.0</td>
<td>4.0</td>
<td>3.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>0.6</td>
<td>0.2</td>
<td>0.8</td>
<td>NaN</td>
<td>2.0</td>
<td>13.0</td>
<td>6.0</td>
<td>1.2</td>
<td>0.4</td>
<td>1.6</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>44.262295</td>
<td>7.868852</td>
<td>7.868852</td>
<td>44.262295</td>
<td>7.868852</td>
<td>7.868852</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>9.0</td>
<td>0.737705</td>
<td>1.180328</td>
<td>1.918033</td>
<td>NaN</td>
<td>5.0</td>
<td>12.0</td>
<td>1.0</td>
<td>3.688525</td>
<td>0.131148</td>
<td>3.819672</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>49.52381</td>
<td>5.714286</td>
<td>4.761905</td>
<td>49.52381</td>
<td>4.761905</td>
<td>5.714286</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>6.0</td>
<td>2.47619</td>
<td>0.571429</td>
<td>3.047619</td>
<td>NaN</td>
<td>5.0</td>
<td>10.0</td>
<td>8.0</td>
<td>4.126984</td>
<td>0.634921</td>
<td>4.761905</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>44.0</td>
<td>6.0</td>
<td>9.0</td>
<td>44.0</td>
<td>9.0</td>
<td>6.0</td>
<td>0.0</td>
<td>1.0</td>
<td>4.0</td>
<td>9.0</td>
<td>0.733333</td>
<td>0.9</td>
<td>1.633333</td>
<td>NaN</td>
<td>6.0</td>
<td>11.0</td>
<td>4.0</td>
<td>4.4</td>
<td>0.6</td>
<td>5.0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>

### Simulating multiple games

Simulating multiple games at once

``` python
predictions = predict_games(predict_game, todays_games, total_simulations=1_000, n_workers=1, disable_progress_bar=True)
```

``` python
predictions.head(5)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 26)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_powerplay_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_shorthanded_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_powerplay_toi</th>
<th data-quarto-table-cell-role="th">predicted_away_shorthanded_toi</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_goals</th>
<th data-quarto-table-cell-role="th">predicted_home_powerplay_goals</th>
<th data-quarto-table-cell-role="th">predicted_home_total_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_gf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_xgf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_gf_p60</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_xgf_p60</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_powerplay_goals</th>
<th data-quarto-table-cell-role="th">predicted_away_total_goals</th>
<th data-quarto-table-cell-role="th">home_win</th>
<th data-quarto-table-cell-role="th">away_win</th>
<th data-quarto-table-cell-role="th">draw</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr>
<td>2025020810</td>
<td>"NYI"</td>
<td>"BUF"</td>
<td>52.5</td>
<td>2.5</td>
<td>5.0</td>
<td>52.5</td>
<td>5.0</td>
<td>2.5</td>
<td>0.0</td>
<td>2.0</td>
<td>16.0</td>
<td>12.0</td>
<td>1.75</td>
<td>0.5</td>
<td>2.25</td>
<td>7.0</td>
<td>4.0</td>
<td>55.0</td>
<td>12.0</td>
<td>3.5</td>
<td>1.0</td>
<td>4.5</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2025020810</td>
<td>"NYI"</td>
<td>"BUF"</td>
<td>52.131148</td>
<td>1.967213</td>
<td>5.901639</td>
<td>52.131148</td>
<td>5.901639</td>
<td>1.967213</td>
<td>0.0</td>
<td>3.0</td>
<td>22.0</td>
<td>10.0</td>
<td>2.606557</td>
<td>0.327869</td>
<td>2.934426</td>
<td>9.0</td>
<td>4.0</td>
<td>59.0</td>
<td>6.0</td>
<td>3.47541</td>
<td>0.590164</td>
<td>4.065574</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2025020810</td>
<td>"NYI"</td>
<td>"BUF"</td>
<td>52.5</td>
<td>4.6875</td>
<td>2.8125</td>
<td>52.5</td>
<td>2.8125</td>
<td>4.6875</td>
<td>0.0</td>
<td>5.0</td>
<td>19.0</td>
<td>9.0</td>
<td>4.375</td>
<td>0.703125</td>
<td>5.078125</td>
<td>9.0</td>
<td>5.0</td>
<td>59.0</td>
<td>15.0</td>
<td>4.375</td>
<td>0.703125</td>
<td>5.078125</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>2025020810</td>
<td>"NYI"</td>
<td>"BUF"</td>
<td>33.0</td>
<td>10.0</td>
<td>2.0</td>
<td>33.0</td>
<td>2.0</td>
<td>10.0</td>
<td>0.0</td>
<td>1.0</td>
<td>22.0</td>
<td>13.0</td>
<td>0.55</td>
<td>2.166667</td>
<td>2.716667</td>
<td>9.0</td>
<td>3.0</td>
<td>66.0</td>
<td>20.0</td>
<td>1.65</td>
<td>0.666667</td>
<td>2.316667</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2025020810</td>
<td>"NYI"</td>
<td>"BUF"</td>
<td>40.0</td>
<td>1.0</td>
<td>0.0</td>
<td>40.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>11.0</td>
<td>5.0</td>
<td>2.666667</td>
<td>0.083333</td>
<td>2.75</td>
<td>8.0</td>
<td>5.0</td>
<td>59.0</td>
<td>16.0</td>
<td>3.333333</td>
<td>0.0</td>
<td>3.333333</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

## Assessing results

Check to see if the simulation is accurate

### Process winners

Aggregate the predictions to “predict” a winner

``` python
predicted_winners = process_winners(predictions)
```

``` python
predicted_winners
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 26)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">predicted_winner</th>
<th data-quarto-table-cell-role="th">predicted_home_win</th>
<th data-quarto-table-cell-role="th">predicted_away_win</th>
<th data-quarto-table-cell-role="th">predicted_draw</th>
<th data-quarto-table-cell-role="th">predicted_home_win_percent</th>
<th data-quarto-table-cell-role="th">predicted_away_win_percent</th>
<th data-quarto-table-cell-role="th">predicted_draw_percent</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_total_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_5v5_xgf_p60_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_xgf_p60_mean</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_shorthanded_toi_mean</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_total_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_5v5_xgf_p60_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_xgf_p60_mean</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_shorthanded_toi_mean</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>2025020817</td>
<td>"MIN"</td>
<td>"FLA"</td>
<td>"FLA"</td>
<td>461</td>
<td>536</td>
<td>3</td>
<td>0.461</td>
<td>0.536</td>
<td>0.003</td>
<td>2.075311</td>
<td>0.739172</td>
<td>2.814484</td>
<td>2.773</td>
<td>6.988</td>
<td>44.898838</td>
<td>6.308386</td>
<td>4.402776</td>
<td>2.113866</td>
<td>0.868102</td>
<td>2.981968</td>
<td>2.826</td>
<td>11.836</td>
<td>44.898838</td>
<td>4.402776</td>
<td>6.308386</td>
</tr>
<tr>
<td>2025020814</td>
<td>"CBJ"</td>
<td>"TBL"</td>
<td>"TBL"</td>
<td>306</td>
<td>690</td>
<td>4</td>
<td>0.306</td>
<td>0.69</td>
<td>0.004</td>
<td>1.906553</td>
<td>0.669293</td>
<td>2.575845</td>
<td>2.45</td>
<td>9.007</td>
<td>46.679519</td>
<td>4.449252</td>
<td>4.628229</td>
<td>2.824785</td>
<td>0.760766</td>
<td>3.585551</td>
<td>3.629</td>
<td>9.881</td>
<td>46.679519</td>
<td>4.628229</td>
<td>4.449252</td>
</tr>
<tr>
<td>2025020813</td>
<td>"OTT"</td>
<td>"CAR"</td>
<td>"CAR"</td>
<td>459</td>
<td>537</td>
<td>4</td>
<td>0.459</td>
<td>0.537</td>
<td>0.004</td>
<td>1.976862</td>
<td>0.557561</td>
<td>2.534423</td>
<td>2.65</td>
<td>5.609</td>
<td>44.872112</td>
<td>5.927584</td>
<td>5.440304</td>
<td>2.062832</td>
<td>0.643848</td>
<td>2.70668</td>
<td>2.756</td>
<td>7.065</td>
<td>44.872112</td>
<td>5.440304</td>
<td>5.927584</td>
</tr>
<tr>
<td>2025020812</td>
<td>"BOS"</td>
<td>"MTL"</td>
<td>"MTL"</td>
<td>397</td>
<td>600</td>
<td>3</td>
<td>0.397</td>
<td>0.6</td>
<td>0.003</td>
<td>1.894879</td>
<td>0.762433</td>
<td>2.657312</td>
<td>2.557</td>
<td>8.452</td>
<td>44.568994</td>
<td>5.414241</td>
<td>6.037765</td>
<td>1.968763</td>
<td>1.177527</td>
<td>3.14629</td>
<td>2.643</td>
<td>11.672</td>
<td>44.568994</td>
<td>6.037765</td>
<td>5.414241</td>
</tr>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>"UTA"</td>
<td>433</td>
<td>564</td>
<td>3</td>
<td>0.433</td>
<td>0.564</td>
<td>0.003</td>
<td>2.00005</td>
<td>0.517972</td>
<td>2.518022</td>
<td>2.606</td>
<td>6.436</td>
<td>46.140582</td>
<td>4.837774</td>
<td>5.105645</td>
<td>2.318929</td>
<td>0.587029</td>
<td>2.905959</td>
<td>3.018</td>
<td>6.945</td>
<td>46.140582</td>
<td>5.105645</td>
<td>4.837774</td>
</tr>
<tr>
<td>2025020810</td>
<td>"NYI"</td>
<td>"BUF"</td>
<td>"BUF"</td>
<td>372</td>
<td>623</td>
<td>5</td>
<td>0.372</td>
<td>0.623</td>
<td>0.005</td>
<td>2.113746</td>
<td>0.624885</td>
<td>2.738631</td>
<td>2.711</td>
<td>8.495</td>
<td>46.857121</td>
<td>4.435936</td>
<td>4.562943</td>
<td>2.491938</td>
<td>0.903787</td>
<td>3.395725</td>
<td>3.19</td>
<td>11.983</td>
<td>46.857121</td>
<td>4.562943</td>
<td>4.435936</td>
</tr>
<tr>
<td>2025020818</td>
<td>"EDM"</td>
<td>"WSH"</td>
<td>"EDM"</td>
<td>500</td>
<td>499</td>
<td>1</td>
<td>0.5</td>
<td>0.499</td>
<td>0.001</td>
<td>2.303046</td>
<td>1.020846</td>
<td>3.323892</td>
<td>2.984</td>
<td>12.598</td>
<td>46.357211</td>
<td>4.832619</td>
<td>4.49217</td>
<td>2.356921</td>
<td>0.908569</td>
<td>3.265491</td>
<td>3.058</td>
<td>12.179</td>
<td>46.357211</td>
<td>4.49217</td>
<td>4.832619</td>
</tr>
<tr>
<td>2025020816</td>
<td>"STL"</td>
<td>"LAK"</td>
<td>"LAK"</td>
<td>378</td>
<td>613</td>
<td>9</td>
<td>0.378</td>
<td>0.613</td>
<td>0.009</td>
<td>1.787255</td>
<td>0.412386</td>
<td>2.199641</td>
<td>2.244</td>
<td>5.351</td>
<td>47.567413</td>
<td>4.592821</td>
<td>4.259765</td>
<td>1.969469</td>
<td>0.647448</td>
<td>2.616917</td>
<td>2.494</td>
<td>9.101</td>
<td>47.567413</td>
<td>4.259765</td>
<td>4.592821</td>
</tr>
<tr>
<td>2025020815</td>
<td>"WPG"</td>
<td>"DET"</td>
<td>"DET"</td>
<td>361</td>
<td>633</td>
<td>6</td>
<td>0.361</td>
<td>0.633</td>
<td>0.006</td>
<td>2.177507</td>
<td>0.577372</td>
<td>2.754879</td>
<td>2.81</td>
<td>8.746</td>
<td>46.495734</td>
<td>3.938766</td>
<td>5.2035</td>
<td>2.535959</td>
<td>0.955715</td>
<td>3.491675</td>
<td>3.274</td>
<td>11.014</td>
<td>46.495734</td>
<td>5.2035</td>
<td>3.938766</td>
</tr>
</tbody>
</table>

</div>

### Assessing predictions

Checking to see if the predictions were correct

``` python
assessed_predictions = assess_predictions(predicted_winners, schedule)
```

``` python
assessed_predictions
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 28)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">predicted_winner</th>
<th data-quarto-table-cell-role="th">actual_winner</th>
<th data-quarto-table-cell-role="th">prediction_correct</th>
<th data-quarto-table-cell-role="th">predicted_home_win</th>
<th data-quarto-table-cell-role="th">predicted_away_win</th>
<th data-quarto-table-cell-role="th">predicted_draw</th>
<th data-quarto-table-cell-role="th">predicted_home_win_percent</th>
<th data-quarto-table-cell-role="th">predicted_away_win_percent</th>
<th data-quarto-table-cell-role="th">predicted_draw_percent</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_total_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_5v5_xgf_p60_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_xgf_p60_mean</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_shorthanded_toi_mean</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_total_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_5v5_xgf_p60_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_xgf_p60_mean</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_shorthanded_toi_mean</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i32</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>2025020817</td>
<td>"MIN"</td>
<td>"FLA"</td>
<td>"FLA"</td>
<td>"FLA"</td>
<td>1</td>
<td>461</td>
<td>536</td>
<td>3</td>
<td>0.461</td>
<td>0.536</td>
<td>0.003</td>
<td>2.075311</td>
<td>0.739172</td>
<td>2.814484</td>
<td>2.773</td>
<td>6.988</td>
<td>44.898838</td>
<td>6.308386</td>
<td>4.402776</td>
<td>2.113866</td>
<td>0.868102</td>
<td>2.981968</td>
<td>2.826</td>
<td>11.836</td>
<td>44.898838</td>
<td>4.402776</td>
<td>6.308386</td>
</tr>
<tr>
<td>2025020814</td>
<td>"CBJ"</td>
<td>"TBL"</td>
<td>"TBL"</td>
<td>"CBJ"</td>
<td>0</td>
<td>306</td>
<td>690</td>
<td>4</td>
<td>0.306</td>
<td>0.69</td>
<td>0.004</td>
<td>1.906553</td>
<td>0.669293</td>
<td>2.575845</td>
<td>2.45</td>
<td>9.007</td>
<td>46.679519</td>
<td>4.449252</td>
<td>4.628229</td>
<td>2.824785</td>
<td>0.760766</td>
<td>3.585551</td>
<td>3.629</td>
<td>9.881</td>
<td>46.679519</td>
<td>4.628229</td>
<td>4.449252</td>
</tr>
<tr>
<td>2025020813</td>
<td>"OTT"</td>
<td>"CAR"</td>
<td>"CAR"</td>
<td>"CAR"</td>
<td>1</td>
<td>459</td>
<td>537</td>
<td>4</td>
<td>0.459</td>
<td>0.537</td>
<td>0.004</td>
<td>1.976862</td>
<td>0.557561</td>
<td>2.534423</td>
<td>2.65</td>
<td>5.609</td>
<td>44.872112</td>
<td>5.927584</td>
<td>5.440304</td>
<td>2.062832</td>
<td>0.643848</td>
<td>2.70668</td>
<td>2.756</td>
<td>7.065</td>
<td>44.872112</td>
<td>5.440304</td>
<td>5.927584</td>
</tr>
<tr>
<td>2025020812</td>
<td>"BOS"</td>
<td>"MTL"</td>
<td>"MTL"</td>
<td>"BOS"</td>
<td>0</td>
<td>397</td>
<td>600</td>
<td>3</td>
<td>0.397</td>
<td>0.6</td>
<td>0.003</td>
<td>1.894879</td>
<td>0.762433</td>
<td>2.657312</td>
<td>2.557</td>
<td>8.452</td>
<td>44.568994</td>
<td>5.414241</td>
<td>6.037765</td>
<td>1.968763</td>
<td>1.177527</td>
<td>3.14629</td>
<td>2.643</td>
<td>11.672</td>
<td>44.568994</td>
<td>6.037765</td>
<td>5.414241</td>
</tr>
<tr>
<td>2025020811</td>
<td>"NSH"</td>
<td>"UTA"</td>
<td>"UTA"</td>
<td>"UTA"</td>
<td>1</td>
<td>433</td>
<td>564</td>
<td>3</td>
<td>0.433</td>
<td>0.564</td>
<td>0.003</td>
<td>2.00005</td>
<td>0.517972</td>
<td>2.518022</td>
<td>2.606</td>
<td>6.436</td>
<td>46.140582</td>
<td>4.837774</td>
<td>5.105645</td>
<td>2.318929</td>
<td>0.587029</td>
<td>2.905959</td>
<td>3.018</td>
<td>6.945</td>
<td>46.140582</td>
<td>5.105645</td>
<td>4.837774</td>
</tr>
<tr>
<td>2025020810</td>
<td>"NYI"</td>
<td>"BUF"</td>
<td>"BUF"</td>
<td>"BUF"</td>
<td>1</td>
<td>372</td>
<td>623</td>
<td>5</td>
<td>0.372</td>
<td>0.623</td>
<td>0.005</td>
<td>2.113746</td>
<td>0.624885</td>
<td>2.738631</td>
<td>2.711</td>
<td>8.495</td>
<td>46.857121</td>
<td>4.435936</td>
<td>4.562943</td>
<td>2.491938</td>
<td>0.903787</td>
<td>3.395725</td>
<td>3.19</td>
<td>11.983</td>
<td>46.857121</td>
<td>4.562943</td>
<td>4.435936</td>
</tr>
<tr>
<td>2025020818</td>
<td>"EDM"</td>
<td>"WSH"</td>
<td>"EDM"</td>
<td>"EDM"</td>
<td>1</td>
<td>500</td>
<td>499</td>
<td>1</td>
<td>0.5</td>
<td>0.499</td>
<td>0.001</td>
<td>2.303046</td>
<td>1.020846</td>
<td>3.323892</td>
<td>2.984</td>
<td>12.598</td>
<td>46.357211</td>
<td>4.832619</td>
<td>4.49217</td>
<td>2.356921</td>
<td>0.908569</td>
<td>3.265491</td>
<td>3.058</td>
<td>12.179</td>
<td>46.357211</td>
<td>4.49217</td>
<td>4.832619</td>
</tr>
<tr>
<td>2025020816</td>
<td>"STL"</td>
<td>"LAK"</td>
<td>"LAK"</td>
<td>"LAK"</td>
<td>1</td>
<td>378</td>
<td>613</td>
<td>9</td>
<td>0.378</td>
<td>0.613</td>
<td>0.009</td>
<td>1.787255</td>
<td>0.412386</td>
<td>2.199641</td>
<td>2.244</td>
<td>5.351</td>
<td>47.567413</td>
<td>4.592821</td>
<td>4.259765</td>
<td>1.969469</td>
<td>0.647448</td>
<td>2.616917</td>
<td>2.494</td>
<td>9.101</td>
<td>47.567413</td>
<td>4.259765</td>
<td>4.592821</td>
</tr>
<tr>
<td>2025020815</td>
<td>"WPG"</td>
<td>"DET"</td>
<td>"DET"</td>
<td>"DET"</td>
<td>1</td>
<td>361</td>
<td>633</td>
<td>6</td>
<td>0.361</td>
<td>0.633</td>
<td>0.006</td>
<td>2.177507</td>
<td>0.577372</td>
<td>2.754879</td>
<td>2.81</td>
<td>8.746</td>
<td>46.495734</td>
<td>3.938766</td>
<td>5.2035</td>
<td>2.535959</td>
<td>0.955715</td>
<td>3.491675</td>
<td>3.274</td>
<td>11.014</td>
<td>46.495734</td>
<td>5.2035</td>
<td>3.938766</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

## Charts

Plotting the results of your simulations

### Color dictionary

Taking the NHL colors and making a dictionary out of them

``` python
color_dict = {
    key: (value["GOAL"] if value["GOAL"] != "#FFFFFF" else value["SHOT"]) for key, value in NHL_COLORS.items()
}
```

### Plotting a single game

Plotting the results for a single game

``` python
dpi = 650
figsize = (8, 5)
nrows = 1  # len(assessed_predictions["home_team"].to_list())
ncols = 1

fig, ax = plt.subplots(nrows=nrows, ncols=ncols, figsize=figsize, dpi=dpi, sharex=True, sharey=True)

for idx, game in enumerate(
    assessed_predictions.filter((pl.col("away_team") == "NSH") | (pl.col("home_team") == "NSH"))
    .sort("predicted_away_total_goals_mean")
    .to_dicts()
):
    # ax = axs[idx]

    plot_predictions = predictions.filter(pl.col("game_id") == game["game_id"])

    venues = ["away", "home"]

    for venue in venues:
        sns.kdeplot(
            data=plot_predictions,
            x=plot_predictions[f"predicted_{venue}_total_goals"],
            bw_adjust=0.5,
            clip_on=False,
            fill=True,
            alpha=0.1,
            linewidth=1.5,
            hue=plot_predictions[f"{venue}_team"],
            palette=color_dict,
            legend=False,
            ax=ax,
        )

    sns.despine(left=True)

    ax.set(yticks=[], ylabel="", xlabel="predicted total goals")

    if idx != (nrows - 1):
        ax.set(xticks=[])

    # else:
    #     ax.set(xlabel="predicted total goals")

    ax.set_title(f"{game['home_team']} vs. {game['away_team']}")

fig.savefig(f"./charts/{latest_date}_NSH.png", dpi=650, bbox_inches="tight", facecolor="white")
```

![](index_files/figure-commonmark/cell-36-output-1.png)

### Plotting today’s games

Plotting the predicted goals for all of today’s games

``` python
dpi = 500
figsize = (4, 12)
nrows = len(assessed_predictions["home_team"].to_list())
ncols = 1

fig, axs = plt.subplots(nrows=nrows, ncols=ncols, figsize=figsize, dpi=dpi, sharex=True, sharey=True)

for idx, game in enumerate(assessed_predictions.sort("predicted_home_total_goals_mean").to_dicts()):
    ax = axs[idx]

    plot_predictions = predictions.filter(pl.col("game_id") == game["game_id"])

    venues = ["away", "home"]

    for venue in venues:
        sns.kdeplot(
            data=plot_predictions,
            x=plot_predictions[f"predicted_{venue}_total_goals"],
            bw_adjust=0.5,
            clip_on=False,
            fill=True,
            alpha=0.1,
            linewidth=1.5,
            hue=plot_predictions[f"{venue}_team"],
            palette=color_dict,
            legend=False,
            ax=ax,
        )

    sns.despine(left=True)

    ax.set(yticks=[], ylabel="")

    if idx != (nrows - 1):
        ax.set(xticks=[])

    # else:
    #     ax.set(xlabel="predicted total goals")

    ax.set_title(f"{game['home_team']} vs. {game['away_team']}", y=0.8)

fig.savefig(f"./charts/{latest_date}.png", dpi=650, bbox_inches="tight", facecolor="white")
```

![](index_files/figure-commonmark/cell-37-output-1.png)

## Assessing predictions

Seeing how the season long predictions have been playing

### Downloading the data from GitHub

Downloading the data from the `chickenstats` repository on GitHub

``` python
csv_url = "https://raw.githubusercontent.com/chickenandstats/chickenstats-blog/refs/heads/main/nbs/blog/posts/tutorials/monte_carlo/results/predicted_winners.csv"

season_predictions = pl.read_csv(csv_url)
```

``` python
season_predictions.head(10)
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 28)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">predicted_winner</th>
<th data-quarto-table-cell-role="th">actual_winner</th>
<th data-quarto-table-cell-role="th">prediction_correct</th>
<th data-quarto-table-cell-role="th">predicted_home_win</th>
<th data-quarto-table-cell-role="th">predicted_away_win</th>
<th data-quarto-table-cell-role="th">predicted_draw</th>
<th data-quarto-table-cell-role="th">predicted_home_win_percent</th>
<th data-quarto-table-cell-role="th">predicted_away_win_percent</th>
<th data-quarto-table-cell-role="th">predicted_draw_percent</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_total_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_5v5_xgf_p60_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_xgf_p60_mean</th>
<th data-quarto-table-cell-role="th">predicted_home_5v5_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_powerplay_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_home_shorthanded_toi_mean</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_total_goals_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_5v5_xgf_p60_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_xgf_p60_mean</th>
<th data-quarto-table-cell-role="th">predicted_away_5v5_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_powerplay_toi_mean</th>
<th
data-quarto-table-cell-role="th">predicted_away_shorthanded_toi_mean</th>
</tr>
<tr>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>2025020695</td>
<td>"WPG"</td>
<td>"LAK"</td>
<td>"LAK"</td>
<td>"WPG"</td>
<td>0</td>
<td>4060</td>
<td>5892</td>
<td>48</td>
<td>0.406</td>
<td>0.5892</td>
<td>0.0048</td>
<td>1.956666</td>
<td>0.641295</td>
<td>2.597961</td>
<td>2.5485</td>
<td>7.1324</td>
<td>46.105153</td>
<td>5.400488</td>
<td>4.396158</td>
<td>2.202071</td>
<td>0.824131</td>
<td>3.026202</td>
<td>2.8657</td>
<td>11.2256</td>
<td>46.105153</td>
<td>4.396158</td>
<td>5.400488</td>
</tr>
<tr>
<td>2025020530</td>
<td>"DET"</td>
<td>"UTA"</td>
<td>"UTA"</td>
<td>"UTA"</td>
<td>1</td>
<td>4511</td>
<td>5435</td>
<td>54</td>
<td>0.4511</td>
<td>0.5435</td>
<td>0.0054</td>
<td>2.187779</td>
<td>0.527668</td>
<td>2.715447</td>
<td>2.7515</td>
<td>6.9293</td>
<td>47.688887</td>
<td>4.564279</td>
<td>3.723834</td>
<td>2.512217</td>
<td>0.435366</td>
<td>2.947583</td>
<td>3.1607</td>
<td>7.008</td>
<td>47.688887</td>
<td>3.723834</td>
<td>4.564279</td>
</tr>
<tr>
<td>2025020148</td>
<td>"PIT"</td>
<td>"STL"</td>
<td>"STL"</td>
<td>"PIT"</td>
<td>0</td>
<td>2056</td>
<td>7903</td>
<td>41</td>
<td>0.2056</td>
<td>0.7903</td>
<td>0.0041</td>
<td>1.962572</td>
<td>1.252185</td>
<td>3.214757</td>
<td>2.782</td>
<td>9.6232</td>
<td>42.352182</td>
<td>7.806185</td>
<td>6.377632</td>
<td>3.922311</td>
<td>1.086998</td>
<td>5.00931</td>
<td>5.5547</td>
<td>10.2336</td>
<td>42.352182</td>
<td>6.377632</td>
<td>7.806185</td>
</tr>
<tr>
<td>2025020593</td>
<td>"CAR"</td>
<td>"DET"</td>
<td>"DET"</td>
<td>"CAR"</td>
<td>0</td>
<td>4917</td>
<td>5037</td>
<td>46</td>
<td>0.4917</td>
<td>0.5037</td>
<td>0.0046</td>
<td>2.486878</td>
<td>0.699148</td>
<td>3.186026</td>
<td>3.1919</td>
<td>9.9487</td>
<td>46.735572</td>
<td>4.217244</td>
<td>4.457284</td>
<td>2.362811</td>
<td>0.840152</td>
<td>3.202963</td>
<td>3.0351</td>
<td>11.309</td>
<td>46.735572</td>
<td>4.457284</td>
<td>4.217244</td>
</tr>
<tr>
<td>2025020427</td>
<td>"OTT"</td>
<td>"NYR"</td>
<td>"NYR"</td>
<td>"NYR"</td>
<td>1</td>
<td>3814</td>
<td>6144</td>
<td>42</td>
<td>0.3814</td>
<td>0.6144</td>
<td>0.0042</td>
<td>1.583031</td>
<td>0.48285</td>
<td>2.065881</td>
<td>1.9963</td>
<td>6.3484</td>
<td>47.649183</td>
<td>4.570142</td>
<td>3.926674</td>
<td>1.909994</td>
<td>0.669286</td>
<td>2.57928</td>
<td>2.4068</td>
<td>10.228</td>
<td>47.649183</td>
<td>3.926674</td>
<td>4.570142</td>
</tr>
<tr>
<td>2025020712</td>
<td>"BOS"</td>
<td>"PIT"</td>
<td>"PIT"</td>
<td>"BOS"</td>
<td>0</td>
<td>3955</td>
<td>5997</td>
<td>48</td>
<td>0.3955</td>
<td>0.5997</td>
<td>0.0048</td>
<td>2.251294</td>
<td>0.423561</td>
<td>2.674854</td>
<td>2.82</td>
<td>5.8083</td>
<td>47.907743</td>
<td>4.377982</td>
<td>3.811276</td>
<td>2.579232</td>
<td>0.621881</td>
<td>3.201113</td>
<td>3.2312</td>
<td>9.8068</td>
<td>47.907743</td>
<td>3.811276</td>
<td>4.377982</td>
</tr>
<tr>
<td>2025020329</td>
<td>"ANA"</td>
<td>"OTT"</td>
<td>"OTT"</td>
<td>"OTT"</td>
<td>1</td>
<td>3673</td>
<td>6274</td>
<td>53</td>
<td>0.3673</td>
<td>0.6274</td>
<td>0.0053</td>
<td>1.782043</td>
<td>0.533371</td>
<td>2.315414</td>
<td>2.3281</td>
<td>8.1117</td>
<td>45.880385</td>
<td>3.939515</td>
<td>5.5705</td>
<td>2.322641</td>
<td>0.583617</td>
<td>2.906258</td>
<td>3.0382</td>
<td>6.2758</td>
<td>45.880385</td>
<td>5.5705</td>
<td>3.939515</td>
</tr>
<tr>
<td>2025020478</td>
<td>"UTA"</td>
<td>"FLA"</td>
<td>"UTA"</td>
<td>"FLA"</td>
<td>0</td>
<td>5255</td>
<td>4681</td>
<td>64</td>
<td>0.5255</td>
<td>0.4681</td>
<td>0.0064</td>
<td>2.160342</td>
<td>0.722947</td>
<td>2.883289</td>
<td>3.0104</td>
<td>7.2158</td>
<td>43.032919</td>
<td>5.999608</td>
<td>6.071273</td>
<td>1.920013</td>
<td>0.8197</td>
<td>2.739713</td>
<td>2.6752</td>
<td>8.1008</td>
<td>43.032919</td>
<td>6.071273</td>
<td>5.999608</td>
</tr>
<tr>
<td>2025020665</td>
<td>"CGY"</td>
<td>"SEA"</td>
<td>"CGY"</td>
<td>"SEA"</td>
<td>0</td>
<td>6768</td>
<td>3177</td>
<td>55</td>
<td>0.6768</td>
<td>0.3177</td>
<td>0.0055</td>
<td>2.404052</td>
<td>0.712321</td>
<td>3.116374</td>
<td>3.0099</td>
<td>9.7929</td>
<td>47.894337</td>
<td>4.372837</td>
<td>3.531827</td>
<td>1.704213</td>
<td>0.540618</td>
<td>2.244831</td>
<td>2.1322</td>
<td>9.1522</td>
<td>47.894337</td>
<td>3.531827</td>
<td>4.372837</td>
</tr>
<tr>
<td>2025020319</td>
<td>"TOR"</td>
<td>"CBJ"</td>
<td>"CBJ"</td>
<td>"CBJ"</td>
<td>1</td>
<td>2905</td>
<td>7062</td>
<td>33</td>
<td>0.2905</td>
<td>0.7062</td>
<td>0.0033</td>
<td>1.959842</td>
<td>0.663825</td>
<td>2.623667</td>
<td>2.431</td>
<td>10.4463</td>
<td>48.388112</td>
<td>3.816683</td>
<td>3.615505</td>
<td>2.558635</td>
<td>1.188494</td>
<td>3.747129</td>
<td>3.1704</td>
<td>19.7096</td>
<td>48.388112</td>
<td>3.615505</td>
<td>3.816683</td>
</tr>
</tbody>
</table>

</div>

## Checking the results

Let’s see how the simulation does

``` python
season_predictions.select(
    pl.col("prediction_correct").sum().alias("correct_predictions"),
    pl.col("game_id").n_unique().alias("total games"),
    (pl.col("prediction_correct").sum() / pl.col("game_id").n_unique()).alias("correct_prediction_percent"),
)

# Kind of meh, TBH
```

<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 3)</small>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr>
<th data-quarto-table-cell-role="th">correct_predictions</th>
<th data-quarto-table-cell-role="th">total games</th>
<th data-quarto-table-cell-role="th">correct_prediction_percent</th>
</tr>
<tr>
<th>i64</th>
<th>u32</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr>
<td>414</td>
<td>796</td>
<td>0.520101</td>
</tr>
</tbody>
</table>

</div>
